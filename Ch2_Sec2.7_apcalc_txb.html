<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Section 2.7 â€“ Derivatives of Composite Functions</title>

  <script src="https://tklesson.com/resources-loader.js"></script>
  <script>loadCommonResources();</script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      line-height: 1.6;
      background: #ffffff;
      color: #00274d;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    #header-placeholder, #footer-placeholder { width: 100%; }

    .page-container { display: flex; flex-grow: 1; }

    .sidebar {
      width: 250px;
      background: #00274d;
      color: white;
      padding: 20px;
      flex-shrink: 0;
      overflow-y: auto;
      max-height: 100vh;
    }

    .sidebar h3 { color: white; margin-top: 0; }
    .sidebar ul { list-style-type: none; padding: 0; }
    .sidebar ul li a {
      display: block;
      padding: 10px;
      color: #c0c0c0;
      text-decoration: none;
      border-bottom: 1px solid #0056b3;
    }
    .sidebar ul li a:hover { background: #0056b3; color: white; }
    .sidebar ul li a.active { background: #0056b3; color: white; font-weight: bold; }

    header {
      background: #00274d;
      color: white;
      padding: 20px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header img { height: 50px; flex-shrink: 0; }
    header h1 {
      margin: 0;
      font-size: 1.8em;
      color: white;
      text-align: center;
      flex-grow: 1;
      flex-shrink: 1;
      min-width: 0;
      padding: 0 10px;
    }
    header a.home-link {
      color: white;
      text-decoration: none;
      font-size: 1em;
      background: #0056b3;
      padding: 6px 12px;
      border-radius: 6px;
      flex-shrink: 0;
    }
    header a.home-link:hover { background: #0073e6; }

    .footer {
      background: #00274d;
      color: white;
      text-align: center;
      padding: 20px;
      width: 100%;
      flex-shrink: 0;
    }

    .main-content { flex-grow: 1; }
    .container { padding: 20px; max-width: 900px; margin: auto; }

    h2 { color: #0056b3; border-bottom: 2px solid #0056b3; padding-bottom: 5px; }
    h3 { color: #0056b3; }

    .nav-buttons { display: flex; justify-content: space-between; margin: 30px auto; }
    .nav-btn {
      background: #0056b3;
      color: white;
      padding: 12px 25px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 1.1em;
    }
    .nav-btn:hover { background: #0073e6; }

    .example, .tip, .check, .definition, .key-concept, .ap-exam-tip, .worked-example, .real-world-app, .practice-problem, .rule-box {
      background: #f0f8ff;
      border-left: 5px solid #0056b3;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
    }
    
    .rule-box { border-left-color: #28a745; background: #e8f5e8; }
    .worked-example { border-left-color: #28a745; }
    .practice-problem { border-left-color: #ff6b35; }
    .real-world-app { border-left-color: #ff6b35; }
    .definition { border-left-color: #28a745; }
    .key-concept { border-left-color: #ffc107; }
    .ap-exam-tip { border-left-color: #dc3545; }
    
    .check p { font-size: 1.2em; }

    .solution {
      display: none;
      background: #e6f2ff;
      border: 1px solid #0056b3;
      padding: 15px;
      margin-top: 10px;
      border-radius: 6px;
    }

    .show-solution-btn {
      background: #0056b3;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    .show-solution-btn:hover { background: #0073e6; }
    
    .interactive-widget {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }
    
    .interactive-controls {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      flex-wrap: wrap;
    }
    
    .interactive-controls input, .interactive-controls button, .interactive-controls select {
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
    }
    
    .interactive-controls button {
      background: #0056b3;
      color: white;
      cursor: pointer;
      border: none;
    }
    
    .interactive-controls button:hover {
      background: #0073e6;
    }
    
    .interactive-result {
      margin-top: 15px;
      padding: 15px;
      background: #e9ecef;
      border-radius: 4px;
    }
    
    .learning-objectives {
      background: #e7f3ff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .learning-objectives h3 {
      margin-top: 0;
    }
    
    .learning-objectives ul {
      padding-left: 20px;
    }
    
    .learning-objectives li {
      margin-bottom: 8px;
    }
    
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: #0056b3;
      color: white;
    }
    
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    
    .progress-container {
      margin: 20px 0;
      background: #f1f1f1;
      border-radius: 8px;
      height: 10px;
    }
    
    .progress-bar {
      height: 100%;
      background: #0056b3;
      border-radius: 8px;
      width: 0%;
      transition: width 0.5s ease-in-out;
    }
    
    .section-completion {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .section-completion button {
      background: #0056b3;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
    }
    
    .section-completion button:hover {
      background: #0073e6;
    }
    
    .step-by-step {
      margin: 15px 0;
      padding-left: 20px;
    }
    
    .step {
      margin-bottom: 10px;
      position: relative;
    }
    
    .step-number {
      position: absolute;
      left: -20px;
      background: #0056b3;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
    }
    
    .example-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .example-type {
      background: #0056b3;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8em;
    }
    
    .problem-set {
      display: grid;
      gap: 20px;
      margin: 25px 0;
    }
    
    .problem-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .problem-card h4 {
      margin-top: 0;
      color: #0056b3;
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 10px;
    }
    
    .difficulty-easy { border-left: 4px solid #28a745; }
    .difficulty-medium { border-left: 4px solid #ffc107; }
    .difficulty-hard { border-left: 4px solid #dc3545; }
    
    .quiz-container {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 25px 0;
    }
    
    .quiz-question {
      margin-bottom: 20px;
    }
    
    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
    }
    
    .quiz-option {
      padding: 10px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .quiz-option:hover {
      background: #e9ecef;
    }
    
    .quiz-option.correct {
      background: #d4edda;
      border-color: #c3e6cb;
    }
    
    .quiz-option.incorrect {
      background: #f8d7da;
      border-color: #f5c6cb;
    }
    
    .quiz-feedback {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      display: none;
    }
    
    .quiz-feedback.correct {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    
    .quiz-feedback.incorrect {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .composite-patterns {
      background: #e8f4f8;
      border: 1px solid #b8d8e8;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .pattern-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .pattern-card {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
    }
    
    .pattern-card h4 {
      margin-top: 0;
      color: #0056b3;
    }
    
    .function-decomposition {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }

    @media (max-width: 768px) {
      .page-container { flex-direction: column; }
      .sidebar { width: 100%; max-height: none; order: -1; }
      .interactive-controls { flex-direction: column; }
      .problem-set { grid-template-columns: 1fr; }
      .pattern-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <script type="module" src="firebase-auth.js"></script>

  <div id="header-placeholder"></div>

  <div class="page-container">
    <div id="sidebar-placeholder"></div>

    <div class="main-content">
      <div class="container">
        <h2>2.7 â€“ Derivatives of Composite Functions</h2>
        
        <div class="learning-objectives">
          <h3>Learning Objectives</h3>
          <p>By the end of this section, you should be able to:</p>
          <ul>
            <li>Apply the Chain Rule to complex composite functions with multiple layers</li>
            <li>Combine the Chain Rule with Product and Quotient Rules</li>
            <li>Differentiate functions involving trigonometric, exponential, and logarithmic compositions</li>
            <li>Recognize and apply derivative patterns for common composite function types</li>
            <li>Solve applied problems involving rates of change of composite quantities</li>
          </ul>
        </div>
        
        <div class="section-completion">
          <span>Section Progress</span>
          <button id="mark-complete-btn">Mark as Complete</button>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="definition">
          <h3>Building on the Chain Rule</h3>
          <p>In Section 2.6, we learned the Chain Rule: \( \frac{dy}{dx} = \frac{dy}{du} \cdot \frac{du}{dx} \)</p>
          <p>Now we'll apply this to more complex composite functions and combine it with other differentiation rules.</p>
        </div>

        <div class="function-decomposition">
          <h3>Function Decomposition Strategy</h3>
          <p>When facing complex composite functions, use this systematic approach:</p>
          <ol>
            <li><strong>Identify the outermost operation</strong> (what happens last in order of operations)</li>
            <li><strong>Work inward</strong>, identifying each layer of composition</li>
            <li><strong>Apply the Chain Rule</strong> for each layer, working from outside in</li>
            <li><strong>Combine with other rules</strong> (Product, Quotient) as needed</li>
          </ol>
        </div>

        <div class="composite-patterns">
          <h3>Common Composite Function Patterns</h3>
          <div class="pattern-grid">
            <div class="pattern-card">
              <h4>Power of a Function</h4>
              <p>\( y = [f(x)]^n \)</p>
              <p>\[ \frac{dy}{dx} = n[f(x)]^{n-1} \cdot f'(x) \]</p>
            </div>
            <div class="pattern-card">
              <h4>Trigonometric Composition</h4>
              <p>\( y = \sin(f(x)) \)</p>
              <p>\[ \frac{dy}{dx} = \cos(f(x)) \cdot f'(x) \]</p>
            </div>
            <div class="pattern-card">
              <h4>Exponential Composition</h4>
              <p>\( y = e^{f(x)} \)</p>
              <p>\[ \frac{dy}{dx} = e^{f(x)} \cdot f'(x) \]</p>
            </div>
            <div class="pattern-card">
              <h4>Logarithmic Composition</h4>
              <p>\( y = \ln(f(x)) \)</p>
              <p>\[ \frac{dy}{dx} = \frac{1}{f(x)} \cdot f'(x) \]</p>
            </div>
          </div>
        </div>

        <div class="interactive-widget">
          <h3>Composite Function Analyzer</h3>
          <p>Enter a composite function to see its decomposition:</p>
          <div class="interactive-controls">
            <input type="text" id="composite-function" placeholder="e.g., sin(x^2+1)" style="flex: 1;">
            <button id="analyze-function">Analyze Function</button>
          </div>
          <div class="interactive-result" id="analysis-result">
            <div id="function-layers"></div>
            <div id="derivative-steps"></div>
          </div>
        </div>

        <h2>Worked Examples</h2>
        
        <div class="worked-example">
          <div class="example-header">
            <h3>Example 1: Triple Composition</h3>
            <span class="example-type">Multiple Chain Rule Applications</span>
          </div>
          <p><strong>Problem:</strong> Find the derivative of \( y = \ln(\sin(3x^2 + 2)) \)</p>
          
          <div class="step-by-step">
            <div class="step">
              <div class="step-number">1</div>
              <p><strong>Decompose the function:</strong></p>
              <p>Let \( u = 3x^2 + 2 \) (innermost)</p>
              <p>Let \( v = \sin(u) \) (middle)</p>
              <p>Then \( y = \ln(v) \) (outermost)</p>
            </div>
            
            <div class="step">
              <div class="step-number">2</div>
              <p><strong>Find each derivative:</strong></p>
              <p>\[ \frac{dy}{dv} = \frac{1}{v} \]</p>
              <p>\[ \frac{dv}{du} = \cos(u) \]</p>
              <p>\[ \frac{du}{dx} = 6x \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">3</div>
              <p><strong>Apply Chain Rule:</strong></p>
              <p>\[ \frac{dy}{dx} = \frac{dy}{dv} \cdot \frac{dv}{du} \cdot \frac{du}{dx} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{1}{v} \cdot \cos(u) \cdot 6x \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">4</div>
              <p><strong>Substitute back:</strong></p>
              <p>\[ \frac{dy}{dx} = \frac{1}{\sin(u)} \cdot \cos(u) \cdot 6x \]</p>
              <p>\[ \frac{dy}{dx} = \frac{1}{\sin(3x^2 + 2)} \cdot \cos(3x^2 + 2) \cdot 6x \]</p>
              <p>\[ \frac{dy}{dx} = 6x \cot(3x^2 + 2) \]</p>
            </div>
          </div>
        </div>
        
        <div class="worked-example">
          <div class="example-header">
            <h3>Example 2: Chain Rule + Product Rule</h3>
            <span class="example-type">Multiple Rules Combined</span>
          </div>
          <p><strong>Problem:</strong> Find the derivative of \( y = x^2 \cdot e^{3x} \)</p>
          
          <div class="step-by-step">
            <div class="step">
              <div class="step-number">1</div>
              <p><strong>Identify the structure:</strong></p>
              <p>This is a product: \( u \cdot v \) where:</p>
              <p>\( u = x^2 \) and \( v = e^{3x} \)</p>
            </div>
            
            <div class="step">
              <div class="step-number">2</div>
              <p><strong>Apply Product Rule:</strong></p>
              <p>\[ \frac{dy}{dx} = u'v + uv' \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">3</div>
              <p><strong>Find u' and v':</strong></p>
              <p>\[ u' = 2x \]</p>
              <p>For \( v = e^{3x} \), use Chain Rule:</p>
              <p>Let \( w = 3x \), then \( v = e^w \)</p>
              <p>\[ \frac{dv}{dw} = e^w \], \( \frac{dw}{dx} = 3 \)</p>
              <p>\[ v' = e^w \cdot 3 = 3e^{3x} \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">4</div>
              <p><strong>Combine results:</strong></p>
              <p>\[ \frac{dy}{dx} = (2x)(e^{3x}) + (x^2)(3e^{3x}) \]</p>
              <p>\[ \frac{dy}{dx} = 2xe^{3x} + 3x^2e^{3x} \]</p>
              <p>\[ \frac{dy}{dx} = xe^{3x}(2 + 3x) \]</p>
            </div>
          </div>
        </div>
        
        <div class="worked-example">
          <div class="example-header">
            <h3>Example 3: Chain Rule + Quotient Rule</h3>
            <span class="example-type">Complex Rational Composite</span>
          </div>
          <p><strong>Problem:</strong> Find the derivative of \( y = \frac{\sin(2x)}{x^2 + 1} \)</p>
          
          <div class="step-by-step">
            <div class="step">
              <div class="step-number">1</div>
              <p><strong>Identify the structure:</strong></p>
              <p>This is a quotient: \( \frac{u}{v} \) where:</p>
              <p>\( u = \sin(2x) \) and \( v = x^2 + 1 \)</p>
            </div>
            
            <div class="step">
              <div class="step-number">2</div>
              <p><strong>Apply Quotient Rule:</strong></p>
              <p>\[ \frac{dy}{dx} = \frac{u'v - uv'}{v^2} \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">3</div>
              <p><strong>Find u' and v':</strong></p>
              <p>\[ v' = 2x \]</p>
              <p>For \( u = \sin(2x) \), use Chain Rule:</p>
              <p>Let \( w = 2x \), then \( u = \sin(w) \)</p>
              <p>\[ \frac{du}{dw} = \cos(w) \], \( \frac{dw}{dx} = 2 \)</p>
              <p>\[ u' = \cos(w) \cdot 2 = 2\cos(2x) \]</p>
            </div>
            
            <div class="step">
              <div class="step-number">4</div>
              <p><strong>Combine results:</strong></p>
              <p>\[ \frac{dy}{dx} = \frac{(2\cos(2x))(x^2 + 1) - (\sin(2x))(2x)}{(x^2 + 1)^2} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{2(x^2 + 1)\cos(2x) - 2x\sin(2x)}{(x^2 + 1)^2} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{2[(x^2 + 1)\cos(2x) - x\sin(2x)]}{(x^2 + 1)^2} \]</p>
            </div>
          </div>
        </div>

        <div class="key-concept">
          <h3>Strategy for Complex Derivatives</h3>
          <p>When facing a complex derivative problem:</p>
          <ol>
            <li><strong>Identify the main structure</strong> - Is it a product? Quotient? Composition?</li>
            <li><strong>Apply the appropriate primary rule</strong> (Product, Quotient, or Chain Rule)</li>
            <li><strong>Use Chain Rule for any composite parts</strong></li>
            <li><strong>Work systematically from outside in</strong></li>
            <li><strong>Simplify your final answer</strong></li>
          </ol>
        </div>

        <div class="interactive-widget">
          <h3>Composite Function Practice</h3>
          <p>Test your skills with these challenging problems:</p>
          <div class="interactive-controls">
            <button id="generate-composite-problem">New Problem</button>
            <button id="show-hint">Show Hint</button>
            <button id="show-solution">Show Solution</button>
          </div>
          <div class="interactive-result" id="practice-area">
            <div id="problem-display"></div>
            <div id="hint-area" style="display: none; margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;"></div>
            <div id="solution-area" style="display: none; margin-top: 10px;"></div>
          </div>
        </div>

        <h2>Common Mistakes to Avoid</h2>
        
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Mistake</th>
                <th>Why It's Wrong</th>
                <th>Correct Approach</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Forgetting inner derivatives in multiple compositions</td>
                <td>Only applies Chain Rule to some layers</td>
                <td>Apply Chain Rule for every layer of composition</td>
              </tr>
              <tr>
                <td>Mixing up order of operations</td>
                <td>Applies rules in wrong sequence</td>
                <td>Always work from outside in</td>
              </tr>
              <tr>
                <td>Not recognizing when to combine rules</td>
                <td>Uses only one rule when multiple are needed</td>
                <td>Identify the overall structure first</td>
              </tr>
              <tr>
                <td>Algebraic errors in simplification</td>
                <td>Correct derivative but messy final answer</td>
                <td>Factor and simplify carefully</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="quiz-container">
          <h3>Quick Concept Check</h3>
          
          <div class="quiz-question">
            <p><strong>Question 1:</strong> What is the derivative of \( y = e^{2x^2} \)?</p>
            <div class="quiz-options">
              <div class="quiz-option" onclick="checkAnswer(this, 'correct')">\( 4xe^{2x^2} \)</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">\( e^{2x^2} \)</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">\( 2e^{2x^2} \)</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">\( 4x^2e^{2x^2} \)</div>
            </div>
            <div class="quiz-feedback correct">âœ“ Correct! Chain Rule: derivative of e^u is e^u times derivative of u.</div>
            <div class="quiz-feedback incorrect">âœ— Remember: For e^(f(x)), derivative is e^(f(x)) Â· f'(x)</div>
          </div>
          
          <div class="quiz-question">
            <p><strong>Question 2:</strong> Which rule would you use first for \( y = x^2 \cdot \sin(3x) \)?</p>
            <div class="quiz-options">
              <div class="quiz-option" onclick="checkAnswer(this, 'correct')">Product Rule</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">Chain Rule</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">Quotient Rule</div>
              <div class="quiz-option" onclick="checkAnswer(this, 'incorrect')">Power Rule</div>
            </div>
            <div class="quiz-feedback correct">âœ“ Correct! The main structure is a product, so start with Product Rule.</div>
            <div class="quiz-feedback incorrect">âœ— Look at the overall structure first - this is a product of two functions.</div>
          </div>
        </div>

        <div class="tip">
          <h3>Problem-Solving Strategy for Composite Functions</h3>
          <ol>
            <li><strong>Analyze the structure</strong> - Identify the main operation</li>
            <li><strong>Choose the primary rule</strong> - Product, Quotient, or Chain Rule</li>
            <li><strong>Decompose composite parts</strong> - Identify inner functions</li>
            <li><strong>Apply Chain Rule systematically</strong> - Work from outside in</li>
            <li><strong>Combine results</strong> - Use appropriate combination of rules</li>
            <li><strong>Simplify</strong> - Factor and reduce the final expression</li>
          </ol>
        </div>
        
        <div class="ap-exam-tip">
          <h3>AP Exam Tip</h3>
          <p>On the AP Calculus exam, complex derivatives often combine multiple rules. Remember to:</p>
          <ul>
            <li>Show your work clearly, especially the decomposition steps</li>
            <li>Label which rule you're using at each step</li>
            <li>Check that you've applied Chain Rule to every composite part</li>
            <li>Simplify your final answer - this can earn you points</li>
            <li>Practice recognizing common patterns quickly</li>
          </ul>
        </div>

        <h2>Practice Problems</h2>
        
        <div class="problem-set">
          <div class="problem-card difficulty-medium">
            <h4>Problem 1: Multiple Composition</h4>
            <p>Find \( \frac{dy}{dx} \) for \( y = \cos^3(2x) \)</p>
            <button class="show-solution-btn" onclick="toggleSolution(this)">Show Solution</button>
            <div class="solution">
              <p>Rewrite: \( y = [\cos(2x)]^3 \)</p>
              <p>Let \( u = \cos(2x) \), then \( y = u^3 \)</p>
              <p>\[ \frac{dy}{du} = 3u^2 \]</p>
              <p>For \( u = \cos(2x) \), let \( v = 2x \), then \( u = \cos(v) \)</p>
              <p>\[ \frac{du}{dv} = -\sin(v) \], \( \frac{dv}{dx} = 2 \)</p>
              <p>\[ \frac{du}{dx} = -\sin(v) \cdot 2 = -2\sin(2x) \]</p>
              <p>\[ \frac{dy}{dx} = 3u^2 \cdot (-2\sin(2x)) = -6[\cos(2x)]^2 \sin(2x) \]</p>
            </div>
          </div>
          
          <div class="problem-card difficulty-hard">
            <h4>Problem 2: Product + Chain Rule</h4>
            <p>Differentiate \( y = x \cdot e^{x^2} \)</p>
            <button class="show-solution-btn" onclick="toggleSolution(this)">Show Solution</button>
            <div class="solution">
              <p><strong>Use Product Rule:</strong></p>
              <p>Let \( u = x \), \( v = e^{x^2} \)</p>
              <p>\[ \frac{dy}{dx} = u'v + uv' \]</p>
              <p>\[ u' = 1 \]</p>
              <p>For \( v = e^{x^2} \), use Chain Rule:</p>
              <p>Let \( w = x^2 \), then \( v = e^w \)</p>
              <p>\[ \frac{dv}{dw} = e^w \], \( \frac{dw}{dx} = 2x \)</p>
              <p>\[ v' = e^w \cdot 2x = 2xe^{x^2} \]</p>
              <p>\[ \frac{dy}{dx} = (1)(e^{x^2}) + (x)(2xe^{x^2}) \]</p>
              <p>\[ \frac{dy}{dx} = e^{x^2} + 2x^2e^{x^2} = e^{x^2}(1 + 2x^2) \]</p>
            </div>
          </div>
          
          <div class="problem-card difficulty-hard">
            <h4>Problem 3: Quotient + Chain Rule</h4>
            <p>Find \( \frac{dy}{dx} \) for \( y = \frac{\ln(3x)}{x^2 + 1} \)</p>
            <button class="show-solution-btn" onclick="toggleSolution(this)">Show Solution</button>
            <div class="solution">
              <p><strong>Use Quotient Rule:</strong></p>
              <p>Let \( u = \ln(3x) \), \( v = x^2 + 1 \)</p>
              <p>\[ \frac{dy}{dx} = \frac{u'v - uv'}{v^2} \]</p>
              <p>\[ v' = 2x \]</p>
              <p>For \( u = \ln(3x) \), use Chain Rule:</p>
              <p>Let \( w = 3x \), then \( u = \ln(w) \)</p>
              <p>\[ \frac{du}{dw} = \frac{1}{w} \], \( \frac{dw}{dx} = 3 \)</p>
              <p>\[ u' = \frac{1}{w} \cdot 3 = \frac{3}{3x} = \frac{1}{x} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{(\frac{1}{x})(x^2 + 1) - (\ln(3x))(2x)}{(x^2 + 1)^2} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{\frac{x^2 + 1}{x} - 2x\ln(3x)}{(x^2 + 1)^2} \]</p>
              <p>\[ \frac{dy}{dx} = \frac{x + \frac{1}{x} - 2x\ln(3x)}{(x^2 + 1)^2} \]</p>
            </div>
          </div>
        </div>

        <div class="nav-buttons">
          <a href="Ch2_Sec2.6_apcalc_txb.html" class="nav-btn">Back â¬… Section 2.6</a>
          <a href="Ch2_Sec2.8_apcalc_txb.html" class="nav-btn">Next âž¡ Section 2.8</a>
        </div>
      </div>
    </div>
  </div>

  <div id="footer-placeholder"></div>

  <script>
    function toggleSolution(button) {
      const solution = button.nextElementSibling;
      if (solution.style.display === "none" || solution.style.display === "") {
        solution.style.display = "block";
        button.textContent = "Hide Solution";
      } else {
        solution.style.display = "none";
        button.textContent = "Show Solution";
      }
    }
    
    // Quiz functionality
    function checkAnswer(option, result) {
      const options = option.parentElement.children;
      const feedback = option.parentElement.nextElementSibling;
      const nextFeedback = feedback.nextElementSibling;
      
      // Remove all classes first
      for (let opt of options) {
        opt.classList.remove('correct', 'incorrect');
      }
      
      // Show appropriate feedback
      if (result === 'correct') {
        option.classList.add('correct');
        feedback.style.display = 'block';
        nextFeedback.style.display = 'none';
      } else {
        option.classList.add('incorrect');
        feedback.style.display = 'none';
        nextFeedback.style.display = 'block';
        
        // Find and highlight correct answer
        for (let opt of options) {
          if (opt.textContent.includes('4xe^{2x^2}') || opt.textContent === 'Product Rule') {
            opt.classList.add('correct');
          }
        }
      }
    }

    // Composite Function Analyzer
    document.getElementById('analyze-function').addEventListener('click', function() {
      const functionInput = document.getElementById('composite-function').value;
      const layersElement = document.getElementById('function-layers');
      const stepsElement = document.getElementById('derivative-steps');
      
      if (!functionInput) {
        layersElement.innerHTML = 'Please enter a function.';
        return;
      }
      
      try {
        // Simple analysis for demonstration
        let analysisHTML = '<p><strong>Function Analysis:</strong></p>';
        let derivativeHTML = '<p><strong>Derivative Steps:</strong></p>';
        
        if (functionInput.includes('sin(') || functionInput.includes('cos(') || functionInput.includes('tan(')) {
          analysisHTML += '<p>This is a trigonometric composite function.</p>';
          derivativeHTML += '<p>Use Chain Rule: derivative of trig(inner) = trig\'(inner) Â· (inner derivative)</p>';
        }
        
        if (functionInput.includes('^')) {
          analysisHTML += '<p>This involves a power function composition.</p>';
          derivativeHTML += '<p>Use Chain Rule: derivative of (inner)^n = n(inner)^(n-1) Â· (inner derivative)</p>';
        }
        
        if (functionInput.includes('e^')) {
          analysisHTML += '<p>This is an exponential composite function.</p>';
          derivativeHTML += '<p>Use Chain Rule: derivative of e^(inner) = e^(inner) Â· (inner derivative)</p>';
        }
        
        if (functionInput.includes('ln(')) {
          analysisHTML += '<p>This is a logarithmic composite function.</p>';
          derivativeHTML += '<p>Use Chain Rule: derivative of ln(inner) = (1/inner) Â· (inner derivative)</p>';
        }
        
        layersElement.innerHTML = analysisHTML;
        stepsElement.innerHTML = derivativeHTML;
        
      } catch (error) {
        layersElement.innerHTML = 'Error analyzing function. Please check your input.';
      }
    });

    // Practice Problem Generator
    const compositeProblems = [
      {
        problem: "Find \( \\frac{dy}{dx} \) for \( y = \\sqrt{\\sin(2x)} \)",
        hint: "Rewrite as y = [sin(2x)]^(1/2), then use Chain Rule twice",
        solution: "\\frac{dy}{dx} = \\frac{1}{2}[\\sin(2x)]^{-1/2} \\cdot \\cos(2x) \\cdot 2 = \\frac{\\cos(2x)}{\\sqrt{\\sin(2x)}}"
      },
      {
        problem: "Differentiate \( y = x^2 \\cdot \\ln(3x) \)",
        hint: "Use Product Rule, then Chain Rule for ln(3x)",
        solution: "\\frac{dy}{dx} = 2x\\ln(3x) + x^2 \\cdot \\frac{1}{x} = 2x\\ln(3x) + x"
      },
      {
        problem: "Find \( \\frac{dy}{dx} \) for \( y = \\frac{e^{2x}}{x^2 + 1} \)",
        hint: "Use Quotient Rule, then Chain Rule for e^(2x)",
        solution: "\\frac{dy}{dx} = \\frac{(2e^{2x})(x^2 + 1) - (e^{2x})(2x)}{(x^2 + 1)^2} = \\frac{2e^{2x}(x^2 + 1 - x)}{(x^2 + 1)^2}"
      }
    ];

    document.getElementById('generate-composite-problem').addEventListener('click', function() {
      const randomIndex = Math.floor(Math.random() * compositeProblems.length);
      const problem = compositeProblems[randomIndex];
      
      document.getElementById('problem-display').innerHTML = `<p><strong>Problem:</strong> ${problem.problem}</p>`;
      document.getElementById('hint-area').innerHTML = `<strong>Hint:</strong> ${problem.hint}`;
      document.getElementById('solution-area').innerHTML = `<strong>Solution:</strong> \\[ ${problem.solution} \\]`;
      document.getElementById('hint-area').style.display = 'none';
      document.getElementById('solution-area').style.display = 'none';
      
      if (window.MathJax) {
        MathJax.typeset();
      }
    });

    document.getElementById('show-hint').addEventListener('click', function() {
      document.getElementById('hint-area').style.display = 'block';
    });

    document.getElementById('show-solution').addEventListener('click', function() {
      document.getElementById('solution-area').style.display = 'block';
      if (window.MathJax) {
        MathJax.typeset();
      }
    });
    
    // Progress tracking
    document.getElementById('mark-complete-btn').addEventListener('click', function() {
      const progressBar = document.getElementById('progress-bar');
      progressBar.style.width = '100%';
      this.textContent = 'Completed!';
      this.disabled = true;
      localStorage.setItem('section-2.7-completed', 'true');
    });
    
    // Load progress on page load
    document.addEventListener('DOMContentLoaded', function() {
      if (localStorage.getItem('section-2.7-completed')) {
        const progressBar = document.getElementById('progress-bar');
        progressBar.style.width = '100%';
        const button = document.getElementById('mark-complete-btn');
        button.textContent = 'Completed!';
        button.disabled = true;
      }
      
      // Generate initial practice problem
      document.getElementById('generate-composite-problem').click();
    });

    async function loadComponent(url, elementId, pageTitle = null) {
      try {
        const response = await fetch(url, { cache: "no-store" });
        if (!response.ok) throw new Error(`Failed to load ${url}: ${response.status}`);
        const html = await response.text();
        const container = document.getElementById(elementId);
        if (!container) return;
        container.innerHTML = html;
        if (pageTitle && elementId === 'header-placeholder') {
          const titleEl = container.querySelector('#section-title') || container.querySelector('h1');
          if (titleEl) titleEl.textContent = pageTitle;
          document.title = pageTitle;
        }
      } catch (err) {
        console.error(err);
        const el = document.getElementById(elementId);
        if (el) el.innerHTML = `<p style="color:red;">Error loading component: ${url}</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await loadComponent('textbookheader.html', 'header-placeholder', 'Section 2.7 â€“ Derivatives of Composite Functions');
      await loadComponent('textbooksidebar.html', 'sidebar-placeholder');
      await loadComponent('textbookfooter.html', 'footer-placeholder');

      const currentUrl = window.location.pathname.split('/').pop().split('?')[0];
      const links = document.querySelectorAll('#sidebar-placeholder a');
      links.forEach(link => {
        const linkUrl = link.getAttribute('href').split('?')[0];
        if (linkUrl === currentUrl) {
          link.classList.add('active');
          link.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    });
  </script>

</body>
</html>
