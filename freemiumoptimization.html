<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP Calculus – Optimization Problems | Tklesson</title>

<link rel="canonical" href="https://tklesson.com/" />
<link rel="icon" type="image/png" sizes="16x16" href="/Tklesson1-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/Tklesson1-32x32.png">
<link rel="apple-touch-icon" href="/Tklesson1-192x192.png">
<meta name="theme-color" content="#0f4c81">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #0f4c81;
  --primary-light: #1a5d9f;
  --primary-dark: #0a3a66;
  --secondary: #ff9e1b;
  --secondary-light: #ffb04d;
  --secondary-dark: #e58a0c;
  --accent: #e6375a;
  --light: #f8fafc;
  --dark: #1e293b;
  --gray: #94a3b8;
  --success: #27ae60;
  --error: #e74c3c;
  --warning: #f39c12;
  --text: #2d3748;
  --text-light: #718096;
  --border: #e2e8f0;
  --card-bg: #ffffff;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  line-height: 1.6;
  color: var(--text);
  background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
  min-height: 100vh;
}

.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

/* Header */
.quiz-header {
  background: var(--gradient);
  color: white;
  padding: 1.5rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.header-content {
  position: relative;
  z-index: 1;
}

.header-logo {
  height: 60px;
  margin-bottom: 0.5rem;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.header-title {
  font-family: 'Roboto Slab', serif;
  font-size: 2.2rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.header-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  color: #e2e8f0;
  font-weight: 400;
}

/* Quiz Container */
.quiz-container {
  background: white;
  border-radius: 1rem;
  margin: 2rem auto;
  padding: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.quiz-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--gradient);
}

.questions-container {
  margin-bottom: 2rem;
}

.question-card {
  background: #f8fafc;
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  border-left: 4px solid var(--primary);
  transition: all 0.3s ease;
  position: relative;
}

.question-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.question-number {
  position: absolute;
  top: -12px;
  left: 15px;
  background: var(--primary);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  box-shadow: var(--shadow);
}

.question-text {
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: var(--dark);
  font-size: 1.1rem;
  padding-top: 0.5rem;
}

.options-container {
  display: grid;
  gap: 0.75rem;
}

.option {
  background: white;
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  padding: 0.75rem 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.95rem;
}

.option:hover {
  border-color: var(--primary);
  background: rgba(15, 76, 129, 0.03);
}

.option.selected {
  border-color: var(--primary);
  background: rgba(15, 76, 129, 0.08);
}

.option.correct {
  border-color: var(--success);
  background: rgba(39, 174, 96, 0.1);
}

.option.incorrect {
  border-color: var(--error);
  background: rgba(231, 76, 60, 0.1);
}

/* Buttons */
.buttons-container {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  outline: none;
  font-size: 1rem;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-secondary {
  background: var(--secondary);
  color: white;
}

.btn-secondary:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #219653;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

/* Results */
.results-container {
  margin-top: 2rem;
  padding: 1.5rem;
  border-radius: 0.75rem;
  background: #f1f5f9;
  display: none;
  border-left: 4px solid var(--primary);
}

.score-display {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  text-align: center;
  color: var(--dark);
}

/* Message */
.message {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-top: 1rem;
  font-weight: 500;
  text-align: center;
  display: none;
}

.message-error {
  background: #fee2e2;
  color: var(--error);
  border: 1px solid #fecaca;
}

.message-success {
  background: #d1fae5;
  color: var(--success);
  border: 1px solid #a7f3d0;
}

/* Animation */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.5s ease forwards;
}

/* Responsive */
@media (max-width: 768px) {
  .quiz-header {
    padding: 1rem;
  }
  
  .header-title {
    font-size: 1.8rem;
  }
  
  .header-subtitle {
    font-size: 1rem;
  }
  
  .quiz-container {
    padding: 1.5rem;
    margin: 1rem;
  }
  
  .buttons-container {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}

/* MathJax styling */
.MathJax {
  font-size: 1.1rem !important;
}

.mjx-chtml {
  outline: none;
}
</style>
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>

<header class="quiz-header">
    <div class="header-content">
        <img src="Tklesson1.png" alt="Tklesson Logo" class="header-logo">
        <h1 class="header-title">AP Calculus – Optimization Problems</h1>
        <p class="header-subtitle">Applied Maximum/Minimum Problems</p>
    </div>
</header>

<div class="container">
    <div class="quiz-container">
        <div id="startScreen" style="text-align: center; padding: 2rem;">
            <p style="font-size: 1.2rem; margin-bottom: 1.5rem;">This quiz contains 10 optimization problems. Use calculus to find optimal solutions.</p>
            <button id="startBtn" class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;">Begin Quiz</button>
        </div>

        <div id="quizContent" style="display: none;">
            <div id="questions-container" class="questions-container"></div>

            <div class="buttons-container">
                <button id="submitBtn" class="btn btn-primary">Submit Answers</button>
                <button id="restartBtn" class="btn btn-secondary">Restart Quiz</button>
                <button id="solution-btn" class="btn btn-success">View Solution Pack</button>
            </div>

            <div id="results-container" class="results-container"></div>
            <div id="message" class="message"></div>
        </div>
    </div>
</div>

<script>
// ============================================================
// AP Calculus Optimization Problems MCQ Quiz
// ============================================================

const questions = [
  { 
    type: 'mcq', 
    q: `A farmer has 2,400 feet of fencing and wants to fence off a rectangular field that borders a straight river. He needs no fence along the river. What are the dimensions of the field that has the largest area?`,
    options: [
      "1200 ft by 600 ft",
      "800 ft by 800 ft", 
      "1000 ft by 700 ft",
      "600 ft by 600 ft"
    ],
    answer: 0,
    explanation: String.raw`First, define the variables: let $x$ be the length parallel to the river and $y$ be the two sides perpendicular to the river. The total fencing used is the constraint: $x + 2y = 2400$, which allows us to express $x$ as $x = 2400 - 2y$. The area of the field is $A = xy$. By substituting the constraint into the area formula, we get a function of one variable: $A(y) = (2400 - 2y)y = 2400y - 2y^2$. To find the maximum area, we calculate the derivative $A'(y) = 2400 - 4y$ and set it to zero. Solving $2400 - 4y = 0$ gives $y = 600$. Since the second derivative $A''(y) = -4$ is negative, this confirms a maximum. Finally, find $x = 2400 - 2(600) = 1200$.`
  },
  { 
    type: 'mcq', 
    q: `A cylindrical can is to hold 1 liter (1000 cm³) of liquid. Find the dimensions that minimize the cost of the metal (surface area).`,
    options: [
      "r ≈ 5.42 cm, h ≈ 10.84 cm",
      "r = 5.77 cm, h = 12.73 cm",
      "r = 6 cm, h = 8.84 cm",
      "r = 4 cm, h = 19.89 cm"
    ],
    answer: 0,
    explanation: String.raw`The volume of a cylinder is $V = \pi r^2 h$. Setting $V = 1000$, we isolate the height: $h = \frac{1000}{\pi r^2}$. We want to minimize the total Surface Area $S = 2\pi r^2 + 2\pi rh$ (the top, bottom, and side). Substituting our expression for $h$ into the area formula gives $S(r) = 2\pi r^2 + 2\pi r(\frac{1000}{\pi r^2}) = 2\pi r^2 + \frac{2000}{r}$. To find the minimum, we take the derivative: $S'(r) = 4\pi r - \frac{2000}{r^2}$. Setting $S'(r) = 0$ leads to $4\pi r^3 = 2000$, so $r^3 = \frac{500}{\pi}$. Solving for $r$ gives $r = \sqrt[3]{\frac{500}{\pi}} \approx 5,42$ cm. Plugging this back into the height formula yields $h = \frac{1000}{\pi(5,42)^2} \approx 10,84$ cm, which is exactly $2r$.`
  },
  { 
    type: 'mcq', 
    q: `Find the point on the parabola y = x² that is closest to the point (3, 0).`,
    options: [
      "(1, 1)",
      "(√2, 2)",
      "(2, 4)",
      "(1.5, 2.25)"
    ],
    answer: 0,
    explanation: String.raw`The distance $d$ between any point $(x, x^2)$ on the parabola and the point $(3, 0)$ is given by $d = \sqrt{(x - 3)^2 + (x^2 - 0)^2}$. To simplify the calculus, we minimize the square of the distance: $f(x) = d^2 = (x - 3)^2 + x^4 = x^4 + x^2 - 6x + 9$. Taking the derivative, we get $f'(x) = 4x^3 + 2x - 6$. We search for roots of $4x^3 + 2x - 6 = 0$. By testing small integers, we find that $x = 1$ works perfectly ($4 + 2 - 6 = 0$). To confirm this is a minimum, we check the second derivative $f''(x) = 12x^2 + 2$, which is always positive. When $x = 1$, $y = 1^2 = 1$, so the closest point is $(1, 1)$.`
  },
  { 
    type: 'mcq', 
    q: `A square piece of cardboard (side length 12 inches) has squares cut out of the corners to fold up into a box. What size cut-out x maximizes volume?`,
    options: [
      "x = 2 inches",
      "x = 3 inches",
      "x = 2.5 inches",
      "x = 1.5 inches"
    ],
    answer: 0,
    explanation: String.raw`When we cut a square of side $x$ from each corner, the resulting box has a height of $x$ and base dimensions of $(12 - 2x)$ by $(12 - 2x)$. The volume is $V(x) = x(12 - 2x)^2 = x(144 - 48x + 4x^2) = 4x^3 - 48x^2 + 144x$. To find the maximum volume, we find the derivative: $V'(x) = 12x^2 - 96x + 144$. Setting this to zero and dividing by 12 gives $x^2 - 8x + 12 = 0$, which factors into $(x - 6)(x - 2) = 0$. The root $x = 6$ is impossible because it would leave no cardboard for the base. Therefore, $x = 2$ must be the optimal cut. The second derivative $V''(x) = 24x - 96$ gives $V''(2) = -48$, confirming a maximum.`
  },
  { 
    type: 'mcq', 
    q: `A company sells x units at price p = 10 - 0.001x. The cost to produce is C(x) = 5000 + 2x. Maximize profit.`,
    options: [
      "4000 units",
      "3000 units",
      "5000 units",
      "4500 units"
    ],
    answer: 0,
    explanation: String.raw`Profit is calculated as Total Revenue minus Total Cost. Revenue $R(x) = x \cdot p = x(10 - 0,001x) = 10x - 0,001x^2$. Total Profit $P(x) = (10x - 0,001x^2) - (5000 + 2x)$, which simplifies to $P(x) = -0,001x^2 + 8x - 5000$. To maximize this, we find the marginal profit by taking the derivative: $P'(x) = -0,002x + 8$. Setting $P'(x) = 0$ gives $0,002x = 8$. Solving for $x$ results in $x = \frac{8}{0,002} = 4000$ units. Since the profit function is a downward-opening parabola (the leading coefficient is negative), this critical point is guaranteed to be a maximum.`
  },
  { 
    type: 'mcq', 
    q: `A poster must have 50 in² of printed matter with 4-inch margins at the top/bottom and 2-inch margins on the sides. Find the dimensions that minimize total paper.`,
    options: [
      "9 in × 18 in",
      "10 in × 15 in",
      "8 in × 20 in",
      "12 in × 12 in"
    ],
    answer: 0,
    explanation: String.raw`Let $x$ be the width and $y$ be the height of the printed area. We know $xy = 50$, so $y = 50/x$. The total dimensions of the poster including margins are $(x + 4)$ for the width and $(y + 8)$ for the height. The total area $A$ is $(x + 4)(y + 8)$. Substituting $y = 50/x$ gives $A(x) = (x + 4)(\frac{50}{x} + 8) = 50 + 8x + \frac{200}{x} + 32 = 8x + \frac{200}{x} + 82$. To minimize the area, we find $A'(x) = 8 - \frac{200}{x^2}$. Setting $A'(x) = 0$ gives $8x^2 = 200$, so $x^2 = 25$ and $x = 5$. If $x = 5$, then $y = 50/5 = 10$. The total poster dimensions are then $(5 + 4) = 9$ inches wide and $(10 + 8) = 18$ inches high.`
  },
  { 
    type: 'mcq', 
    q: `Find the dimensions of the largest rectangle that can be inscribed in a semicircle of radius R = 2.`,
    options: [
      "Width = 2√2, Height = √2",
      "Width = √2, Height = 2√2",
      "Width = 2, Height = √3",
      "Width = √6, Height = √2"
    ],
    answer: 0,
    explanation: String.raw`Assume the semicircle is defined by $x^2 + y^2 = 4$ for $y \ge 0$. A rectangle inscribed here will have corners at $(-x, 0), (x, 0), (x, y),$ and $(-x, y)$. This means the width is $2x$ and the height is $y = \sqrt{4 - x^2}$. The area is $A(x) = 2x\sqrt{4 - x^2}$. To find the maximum, we use the product rule for the derivative: $A'(x) = 2\sqrt{4 - x^2} + 2x \cdot \frac{1}{2}(4 - x^2)^{-1/2} \cdot (-2x) = 2\sqrt{4 - x^2} - \frac{2x^2}{\sqrt{4 - x^2}}$. Combining terms over a common denominator gives $A'(x) = \frac{2(4 - x^2) - 2x^2}{\sqrt{4 - x^2}} = \frac{8 - 4x^2}{\sqrt{4 - x^2}}$. Setting the numerator to zero gives $4x^2 = 8$, so $x = \sqrt{2}$. The width is $2\sqrt{2}$ and the height is $\sqrt{4 - (\sqrt{2})^2} = \sqrt{2}$.`
  },
  { 
    type: 'mcq', 
    q: `Two poles (10ft and 15ft) stand 20ft apart. A wire is attached to the top of each and anchored to the ground between them. Where should it be anchored to minimize wire length?`,
    options: [
      "8 ft from the 10ft pole",
      "10 ft from the 10ft pole",
      "12 ft from the 10ft pole",
      "7.5 ft from the 10ft pole"
    ],
    answer: 0,
    explanation: String.raw`Let $x$ be the distance from the 10-ft pole to the anchor point. The distance from the anchor point to the 15-ft pole is then $(20 - x)$. Using the Pythagorean theorem, the total length of the wire is $L(x) = \sqrt{10^2 + x^2} + \sqrt{15^2 + (20 - x)^2}$. To minimize $L$, we find $L'(x) = \frac{x}{\sqrt{100 + x^2}} - \frac{20 - x}{\sqrt{225 + (20 - x)^2}}$. Setting $L'(x) = 0$ implies that the sine of the angles made by the wires must be equal. This corresponds to the similar triangles ratio: $\frac{x}{10} = \frac{20 - x}{15}$. Cross-multiplying gives $15x = 10(20 - x) = 200 - 10x$. Adding $10x$ to both sides yields $25x = 200$, so $x = 8$ feet from the shorter pole.`
  },
  { 
    type: 'mcq', 
    q: `A truck gets G(v) = 480/v miles per gallon at speed v. Diesel costs \\$4/gal and the driver is paid \\$20/hr. Minimize cost for a 500-mile trip.`,
    options: [
      "v ≈ 49 mph",
      "v = 55 mph",
      "v = 45 mph",
      "v = 60 mph"
    ],
    answer: 0,
    explanation: String.raw`Total cost consists of fuel cost and time cost. Fuel used is Distance / MPG = $500 / (480/v) = \frac{500v}{480} = \frac{25v}{24}$ gallons. At $\$4$/gallon, fuel cost is $4 \cdot \frac{25v}{24} = \frac{25}{6}v$. The time taken for the trip is Distance / Speed = $500/v$ hours. At $\$20$/hour, time cost is $20 \cdot \frac{500}{v} = \frac{10000}{v}$. Total cost $C(v) = \frac{25}{6}v + \frac{10000}{v}$. To minimize, find the derivative $C'(v) = \frac{25}{6} - \frac{10000}{v^2}$. Setting $C'(v) = 0$ gives $v^2 = \frac{10000 \cdot 6}{25} = 400 \cdot 6 = 2400$. Thus, $v = \sqrt{2400} \approx 48,99$ mph.`
  },
  { 
    type: 'mcq', 
    q: `A Norman window (rectangle with a semicircle on top) has a perimeter of 30ft. Find dimensions for maximum light (area).`,
    options: [
      "r ≈ 4.2 ft, h ≈ 4.2 ft",
      "r = 5.4 ft, h = 5.4 ft",
      "r = 3.8 ft, h = 6.1 ft",
      "r = 4.9 ft, h = 5.2 ft"
    ],
    answer: 0,
    explanation: String.raw`Let $r$ be the radius of the semicircle and $h$ be the height of the rectangular part. The perimeter includes the bottom ($2r$), two vertical sides ($2h$), and the curved top ($\pi r$), so $P = 2r + 2h + \pi r = 30$. Solving for $h$, we get $2h = 30 - r(2 + \pi)$, or $h = 15 - r(1 + \frac{\pi}{2})$. The total area $A$ is the rectangle ($2rh$) plus the semicircle ($\frac{1}{2}\pi r^2$). Substituting $h$ gives $A(r) = 2r(15 - r - \frac{\pi}{2}r) + \frac{\pi}{2}r^2 = 30r - 2r^2 - \pi r^2 + \frac{\pi}{2}r^2 = 30r - 2r^2 - \frac{\pi}{2}r^2$. Taking the derivative $A'(r) = 30 - 4r - \pi r$ and setting it to zero gives $r(4 + \pi) = 30$, so $r = \frac{30}{4 + \pi} \approx 4,2$ ft. Substituting this $r$ back into the $h$ equation also gives $h \approx 4,2$ ft.`
  }
];

// DOM elements
const questionsContainer = document.getElementById('questions-container');
const submitBtn = document.getElementById('submitBtn');
const restartBtn = document.getElementById('restartBtn');
const solutionBtn = document.getElementById('solution-btn');
const resultsContainer = document.getElementById('results-container');
const messageEl = document.getElementById('message');
const startBtn = document.getElementById('startBtn');
const startScreen = document.getElementById('startScreen');
const quizContent = document.getElementById('quizContent');

// Quiz state
let quizSubmitted = false;
let userAnswers = new Array(questions.length).fill(-1);

// Fisher-Yates shuffle algorithm
function shuffleArray(arr) { 
    const shuffled = [...arr];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Shuffle questions and options
function shuffleQuestions() {
    const shuffledQuestions = shuffleArray(questions.map(q => {
        // Create array of option indices
        const indices = [0, 1, 2, 3];
        const shuffledIndices = shuffleArray([...indices]);
        
        return {
            ...q,
            shuffledOptions: shuffledIndices.map(i => q.options[i]),
            correctAnswerIndex: shuffledIndices.indexOf(q.answer)
        };
    }));
    
    return shuffledQuestions;
}

let currentQuestions = [];

// Initialize quiz
function initQuiz() {
    currentQuestions = shuffleQuestions();
    renderQuiz();
    quizSubmitted = false;
    userAnswers = new Array(currentQuestions.length).fill(-1);
    solutionBtn.style.display = 'none';
    resultsContainer.style.display = 'none';
    messageEl.style.display = 'none';
}

// Render questions
function renderQuiz() {
    questionsContainer.innerHTML = '';
    
    currentQuestions.forEach((question, index) => {
        const questionEl = document.createElement('div');
        questionEl.className = 'question-card animate-fadeIn';
        questionEl.style.animationDelay = `${index * 0.05}s`;
        
        let optionsHTML = '';
        question.shuffledOptions.forEach((option, optionIndex) => {
            const isSelected = userAnswers[index] === optionIndex;
            const optionId = `q${index}_${optionIndex}`;
            optionsHTML += `
                <div class="option ${isSelected ? 'selected' : ''}" data-index="${index}" data-option="${optionIndex}">
                    <input type="radio" id="${optionId}" name="q${index}" ${isSelected ? 'checked' : ''}>
                    <label for="${optionId}">${option}</label>
                </div>
            `;
        });
        
        questionEl.innerHTML = `
            <div class="question-number">${index + 1}</div>
            <div class="question-text">${question.q}</div>
            <div class="options-container">${optionsHTML}</div>
        `;
        questionsContainer.appendChild(questionEl);
    });
    
    // Add event listeners to options
    document.querySelectorAll('.option').forEach(option => {
        option.addEventListener('click', function() {
            const questionIndex = parseInt(this.dataset.index);
            const optionIndex = parseInt(this.dataset.option);
            
            // Remove selected class from all options in this question
            const questionOptions = document.querySelectorAll(`.option[data-index="${questionIndex}"]`);
            questionOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Add selected class to clicked option
            this.classList.add('selected');
            
            // Update the radio button
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
            
            // Store user's answer
            userAnswers[questionIndex] = optionIndex;
        });
    });
    
    // Re-render MathJax
    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise();
    }
}

// Check answers
function checkAnswers() {
    const unanswered = userAnswers.filter(answer => answer === -1).length;
    if (unanswered > 0) {
        showMessage(`Please answer all questions. ${unanswered} remaining.`, 'error');
        return;
    }
    
    let score = 0;
    
    // Check each question
    currentQuestions.forEach((question, index) => {
        const userAnswerIndex = userAnswers[index];
        const isCorrect = userAnswerIndex === question.correctAnswerIndex;
        
        // Get the option element
        const optionEl = document.querySelector(`.option[data-index="${index}"][data-option="${userAnswerIndex}"]`);
        
        if (isCorrect) {
            score++;
            optionEl.classList.add('correct');
        } else {
            optionEl.classList.add('incorrect');
            
            // Show correct answer
            const correctOptionEl = document.querySelector(`.option[data-index="${index}"][data-option="${question.correctAnswerIndex}"]`);
            correctOptionEl.classList.add('correct');
        }
        
        // Disable all options in this question
        const questionOptions = document.querySelectorAll(`.option[data-index="${index}"]`);
        questionOptions.forEach(opt => {
            const radio = opt.querySelector('input[type="radio"]');
            if (radio) radio.disabled = true;
            opt.style.cursor = 'default';
        });
    });
    
    // Display results
    showResults(score);
    
    // Show solution button
    solutionBtn.style.display = 'inline-block';
    quizSubmitted = true;
    
    // Show success message
    showMessage(`Quiz submitted! Score: ${score}/${currentQuestions.length}`, 'success');
}

// Show results
function showResults(score) {
    resultsContainer.style.display = 'block';
    const percentage = (score / currentQuestions.length) * 100;
    
    let feedback = '';
    if (percentage >= 90) feedback = 'Excellent! You master optimization techniques.';
    else if (percentage >= 70) feedback = 'Good work! You understand most optimization problems.';
    else if (percentage >= 50) feedback = 'Keep practicing! Review constraint and objective functions.';
    else feedback = 'Review the fundamental steps: 1) Identify variables, 2) Write constraint, 3) Write objective, 4) Differentiate.';
    
    resultsContainer.innerHTML = `
        <div class="score-display">Score: ${score} / ${currentQuestions.length}</div>
        <div style="text-align: center;">${feedback}</div>
        <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light); text-align: center;">
            Click "View Solution Pack" for step-by-step solutions.
        </div>
    `;
}

// Show message
function showMessage(text, type) {
    messageEl.textContent = text;
    messageEl.className = `message message-${type}`;
    messageEl.style.display = 'block';
    setTimeout(() => {
        messageEl.style.display = 'none';
    }, 4000);
}

// Show solution pack
function showSolution() {
    const solutionWindow = window.open('', '_blank', 'width=1000,height=800');
    
    const solutionHTML = `
        <!DOCTYPE html>
        <html>
        <head>
            <title>AP Calculus Optimization - Solution Pack | Tklesson</title>
            <script>
                window.MathJax = {
                    tex: {
                        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']],
                        displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']],
                        processEscapes: true,
                        processEnvironments: true
                    }
                };
            <\/script>
            <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"><\/script>
            <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
            <style>
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    line-height: 1.6;
                    max-width: 900px;
                    margin: 0 auto;
                    padding: 20px;
                    background: #f9f9f9;
                }
                .solution-card {
                    background: white;
                    padding: 20px;
                    margin: 15px 0;
                    border-radius: 8px;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
                    border-left: 4px solid #0f4c81;
                }
                .problem {
                    font-weight: 600;
                    color: #0f4c81;
                    margin-bottom: 10px;
                }
                .answer {
                    color: #27ae60;
                    font-weight: 600;
                    margin: 10px 0;
                    padding: 8px;
                    background: #f0f8ff;
                    border-radius: 4px;
                }
                .explanation {
                    background: #f8fafc;
                    padding: 15px;
                    border-radius: 6px;
                    margin-top: 10px;
                    font-size: 0.95em;
                }
                .steps {
                    margin-left: 15px;
                    margin-top: 10px;
                }
                .step {
                    margin: 5px 0;
                }
                h1 {
                    color: #0f4c81;
                    border-bottom: 2px solid #0f4c81;
                    padding-bottom: 10px;
                }
            </style>
        </head>
        <body>
            <h1>AP Calculus Optimization - Complete Solutions</h1>
            <p>Step-by-step solutions using calculus to find maximum/minimum values.</p>
            
            ${questions.map((q, i) => `
                <div class="solution-card">
                    <div class="problem"><strong>Problem ${i+1}:</strong> ${q.q}</div>
                    <div class="answer"><strong>Answer:</strong> ${q.options[q.answer]}</div>
                    <div class="explanation">
                        <strong>Solution Steps:</strong>
                        <div class="steps">
                            ${q.explanation.split('.').filter(s => s.trim()).map(step => 
                                `<div class="step">• ${step.trim()}.</div>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `).join('')}
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-top: 20px;">
                <strong>Optimization Strategy:</strong><br>
                1. <strong>Define Variables:</strong> Identify what you're trying to optimize and what can vary.<br>
                2. <strong>Write Constraint:</strong> Equation relating variables (given information).<br>
                3. <strong>Write Objective:</strong> Function to maximize/minimize in terms of one variable.<br>
                4. <strong>Differentiate:</strong> Find critical points where derivative $= 0$.<br>
                5. <strong>Test:</strong> Verify it's a maximum/minimum (first or second derivative test).<br>
                6. <strong>Answer:</strong> State complete solution with units.
            </div>
        </body>
        </html>
    `;
    
    solutionWindow.document.write(solutionHTML);
    solutionWindow.document.close();
}

// Event listeners
submitBtn.addEventListener('click', checkAnswers);

restartBtn.addEventListener('click', () => {
    initQuiz();
    showMessage('Quiz restarted. Apply optimization techniques carefully.', 'success');
});

solutionBtn.addEventListener('click', showSolution);

startBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    quizContent.style.display = 'block';
    initQuiz();
});

// Initial setup
document.addEventListener('DOMContentLoaded', () => {
    quizContent.style.display = 'none';
    startScreen.style.display = 'block';
});
</script>

</body>
</html>
