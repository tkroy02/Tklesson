<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP Biology – Expert Level | Tklesson</title>

<link rel="canonical" href="https://tklesson.com/" />
<link rel="icon" type="image/png" sizes="16x16" href="/Tklesson1-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/Tklesson1-32x32.png">
<link rel="apple-touch-icon" href="/Tklesson1-192x192.png">
<meta name="theme-color" content="#0f4c81">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #0f4c81;
  --primary-light: #1a5d9f;
  --primary-dark: #0a3a66;
  --secondary: #9c27b0;
  --secondary-light: #ba68c8;
  --secondary-dark: #7b1fa2;
  --accent: #e6375a;
  --light: #f8fafc;
  --dark: #1e293b;
  --gray: #94a3b8;
  --success: #27ae60;
  --error: #e74c3c;
  --warning: #f39c12;
  --text: #2d3748;
  --text-light: #718096;
  --border: #e2e8f0;
  --card-bg: #ffffff;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  line-height: 1.6;
  color: var(--text);
  background: linear-gradient(135deg, #f0f8ff 0%, #f5f0ff 100%);
  min-height: 100vh;
}

.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

/* Header */
.quiz-header {
  background: var(--gradient);
  color: white;
  padding: 1.5rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.header-content {
  position: relative;
  z-index: 1;
}

.header-logo {
  height: 60px;
  margin-bottom: 0.5rem;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.header-title {
  font-family: 'Roboto Slab', serif;
  font-size: 2.2rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.header-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  color: #e2e8f0;
  font-weight: 400;
}

/* Quiz Container */
.quiz-container {
  background: white;
  border-radius: 1rem;
  margin: 2rem auto;
  padding: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.quiz-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--gradient);
}

.questions-container {
  margin-bottom: 2rem;
}

.question-card {
  background: #f8fafc;
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  border-left: 4px solid var(--secondary);
  transition: all 0.3s ease;
  position: relative;
}

.question-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.question-number {
  position: absolute;
  top: -12px;
  left: 15px;
  background: var(--secondary);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  box-shadow: var(--shadow);
}

.question-text {
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: var(--dark);
  font-size: 1.1rem;
  padding-top: 0.5rem;
}

.options-container {
  display: grid;
  gap: 0.75rem;
}

.option {
  background: white;
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  padding: 0.75rem 1rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.95rem;
  display: flex;
  align-items: flex-start;
}

.option-label {
  font-weight: 600;
  margin-right: 10px;
  min-width: 25px;
  color: var(--secondary);
}

.option-content {
  flex: 1;
}

.option:hover {
  border-color: var(--secondary);
  background: rgba(156, 39, 176, 0.03);
}

.option.selected {
  border-color: var(--secondary);
  background: rgba(156, 39, 176, 0.08);
}

.option.correct {
  border-color: var(--success);
  background: rgba(39, 174, 96, 0.1);
}

.option.incorrect {
  border-color: var(--error);
  background: rgba(231, 76, 60, 0.1);
}

/* Buttons */
.buttons-container {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  outline: none;
  font-size: 1rem;
  font-family: 'Poppins', sans-serif;
}

.btn-primary {
  background: var(--secondary);
  color: white;
}

.btn-primary:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-secondary {
  background: var(--primary);
  color: white;
}

.btn-secondary:hover {
  background: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #219653;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

/* Results */
.results-container {
  margin-top: 2rem;
  padding: 1.5rem;
  border-radius: 0.75rem;
  background: #f1f5f9;
  display: none;
  border-left: 4px solid var(--secondary);
}

.score-display {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  text-align: center;
  color: var(--dark);
}

/* Message */
.message {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-top: 1rem;
  font-weight: 500;
  text-align: center;
  display: none;
}

.message-error {
  background: #fee2e2;
  color: var(--error);
  border: 1px solid #fecaca;
}

.message-success {
  background: #d1fae5;
  color: var(--success);
  border: 1px solid #a7f3d0;
}

/* Animation */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.5s ease forwards;
}

/* Progress Bar */
.progress-container {
  margin: 1.5rem 0;
}

.progress-bar {
  height: 8px;
  background: #e2e8f0;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--secondary);
  width: 0%;
  transition: width 0.5s ease;
}

.progress-text {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: var(--text-light);
}

/* Difficulty Indicator */
.difficulty-badge {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  background: #ff6b6b;
  color: white;
  border-radius: 1rem;
  font-size: 0.8rem;
  font-weight: 600;
  margin-left: 0.5rem;
  vertical-align: middle;
}

/* Responsive */
@media (max-width: 768px) {
  .quiz-header {
    padding: 1rem;
  }
  
  .header-title {
    font-size: 1.8rem;
  }
  
  .header-subtitle {
    font-size: 1rem;
  }
  
  .quiz-container {
    padding: 1.5rem;
    margin: 1rem;
  }
  
  .buttons-container {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}
</style>
</head>
<body>

<header class="quiz-header">
    <div class="header-content">
        <img src="Tklesson1.png" alt="Tklesson Logo" class="header-logo">
        <h1 class="header-title">AP Biology – Expert Level</h1>
        <p class="header-subtitle">20 Advanced Questions – Medium-Level Difficulty</p>
    </div>
</header>

<div class="container">
    <div class="quiz-container">
        <div id="startScreen" style="text-align: center; padding: 2rem;">
            <h2 style="color: var(--secondary); margin-bottom: 1rem;">AP Biology Exam Challenge</h2>
            <p style="font-size: 1.1rem; margin-bottom: 1.5rem; line-height: 1.6;">
                This 20-question assessment reflects AP Biology exam rigor, testing conceptual depth, analytical reasoning, and application of biological principles at the college level.
            </p>
            <div style="background: #f5f0ff; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 2rem;">
                <h3 style="color: var(--secondary-dark); margin-bottom: 0.75rem;">AP Curriculum Topics:</h3>
                <ul style="text-align: left; display: inline-block; margin: 0 auto; list-style: none; padding: 0;">
                    <li>✓ Cellular Energetics & Metabolism</li>
                    <li>✓ Gene Expression & Regulation</li>
                    <li>✓ Cell Communication & Signal Transduction</li>
                    <li>✓ Heredity & Genetic Variation</li>
                    <li>✓ Natural Selection & Evolution</li>
                    <li>✓ Ecological Systems & Interactions</li>
                </ul>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <span class="difficulty-badge" style="background: #ff6b6b;">AP Exam Level</span>
                <span style="font-size: 0.9rem; color: var(--text-light);">Designed for students targeting AP Score 4-5</span>
            </div>
            <button id="startBtn" class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;">Begin AP Biology Quiz</button>
        </div>

        <div id="quizContent" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span>Question: <span id="currentQuestion">1</span>/20</span>
                    <span>Time: <span id="quizTimer">30:00</span></span>
                </div>
            </div>
            
            <div id="questions-container" class="questions-container"></div>

            <div class="buttons-container">
                <button id="prevBtn" class="btn btn-secondary">Previous</button>
                <button id="nextBtn" class="btn btn-primary">Next Question</button>
                <button id="submitBtn" class="btn btn-success" style="display: none;">Submit Quiz</button>
                <button id="restartBtn" class="btn btn-secondary">Restart Quiz</button>
            </div>

            <div id="results-container" class="results-container"></div>
            <div id="message" class="message"></div>
        </div>
    </div>
</div>

<script>
// ============================================================
// AP Biology Expert Level MCQ Quiz (20 Advanced Questions)
// Balanced answer lengths, college-level difficulty
// ============================================================

// ============================================================
// AP Biology Challenge Quiz (Within Official Curriculum)
// Advanced but appropriate for AP exam
// ============================================================

const questions = [
  {
    q: "In a plant cell, where do the light-dependent reactions of photosynthesis occur?",
    options: [
      "Thylakoid membranes",
      "Stroma",
      "Cytoplasm",
      "Mitochondrial matrix"
    ],
    answer: 0,
    explanation: "The light-dependent reactions occur in the thylakoid membranes of chloroplasts, where photosystems I and II, electron transport chains, and ATP synthase are located. This creates ATP and NADPH while splitting water and releasing oxygen."
  },
  {
    q: "Which process would be most directly affected by a mutation in DNA polymerase III?",
    options: [
      "DNA replication",
      "Transcription",
      "Translation",
      "Protein folding"
    ],
    answer: 0,
    explanation: "DNA polymerase III is the main enzyme for DNA replication in prokaryotes (eukaryotes use DNA polymerases α, δ, and ε). Mutations affect replication fidelity and speed. Transcription uses RNA polymerase, translation uses ribosomes, and protein folding involves chaperones."
  },
  {
    q: "A cell with a diploid number of 12 undergoes meiosis. How many chromosomes will each gamete have?",
    options: [
      "6",
      "12",
      "24",
      "48"
    ],
    answer: 0,
    explanation: "Meiosis reduces chromosome number by half. Diploid (2n) = 12, so haploid (n) gametes = 6. Mitosis maintains diploid number; meiosis I separates homologous chromosomes, meiosis II separates sister chromatids."
  },
  {
    q: "Which cellular process is most similar in both photosynthesis and cellular respiration?",
    options: [
      "Chemiosmosis",
      "Glycolysis",
      "Calvin cycle",
      "Krebs cycle"
    ],
    answer: 0,
    explanation: "Chemiosmosis occurs in both: in mitochondria (respiration), protons pumped during ETC create gradient for ATP synthesis; in chloroplasts (photosynthesis), light reactions create proton gradient across thylakoid membrane for ATP production via ATP synthase."
  },
  {
    q: "In the lac operon, what role does cAMP play in gene regulation?",
    options: [
      "Activates CAP protein",
      "Binds to repressor",
      "Directly binds DNA",
      "Degrades lactose"
    ],
    answer: 0,
    explanation: "When glucose is low, cAMP levels rise. cAMP binds to CAP (catabolite activator protein), forming cAMP-CAP complex that binds lac operon promoter, enhancing transcription. This is catabolite repression: high glucose → low cAMP → no activation."
  },
  {
    q: "Which type of bond is primarily responsible for holding the α-helix structure of proteins?",
    options: [
      "Hydrogen bonds",
      "Ionic bonds",
      "Disulfide bonds",
      "Peptide bonds"
    ],
    answer: 0,
    explanation: "α-helices are stabilized by hydrogen bonds between carbonyl oxygen (C=O) of one amino acid and amide hydrogen (N-H) of another four residues away. Peptide bonds connect amino acids; disulfide bonds stabilize tertiary structure; ionic bonds are between charged side chains."
  },
  {
    q: "During which phase of the cell cycle is DNA replicated?",
    options: [
      "S phase",
      "G1 phase",
      "G2 phase",
      "M phase"
    ],
    answer: 0,
    explanation: "DNA replication occurs during S (synthesis) phase. G1 is growth/preparation for S phase. G2 is growth/preparation for mitosis. M phase is mitosis/cytokinesis. The cell cycle order: G1 → S → G2 → M."
  },
  {
    q: "What is the primary function of tRNA in protein synthesis?",
    options: [
      "Carry amino acids",
      "Form ribosome structure",
      "Carry genetic code",
      "Catalyze peptide bonds"
    ],
    answer: 0,
    explanation: "tRNA carries specific amino acids to ribosomes. Anticodon on tRNA base-pairs with mRNA codon. rRNA forms ribosome structure and catalyzes peptide bonds. mRNA carries genetic code from DNA to ribosome."
  },
  {
    q: "Which graph best represents enzyme activity with increasing substrate concentration?",
    options: [
      "Hyperbolic curve",
      "Linear increase",
      "Exponential decay",
      "Sinusoidal wave"
    ],
    answer: 0,
    explanation: "Michaelis-Menten kinetics show hyperbolic curve: rapid increase at low [S], plateaus at high [S] (Vmax) when enzyme saturated. Km = [S] at ½Vmax. Competitive inhibitors increase apparent Km; noncompetitive decrease Vmax."
  },
  {
    q: "A plant wilts when placed in a hypertonic solution because:",
    options: [
      "Water leaves cells",
      "Water enters cells",
      "Solutes leave cells",
      "Membranes rupture"
    ],
    answer: 0,
    explanation: "Hypertonic solution has higher solute concentration than cell. Water moves out by osmosis, causing plasmolysis: membrane pulls away from cell wall, plant wilts. Hypotonic solution causes turgor pressure; isotonic no net movement."
  },
  {
    q: "Which process produces the most ATP per glucose molecule?",
    options: [
      "Oxidative phosphorylation",
      "Glycolysis",
      "Fermentation",
      "Krebs cycle"
    ],
    answer: 0,
    explanation: "Complete glucose oxidation: ~30-32 ATP total. Oxidative phosphorylation (ETC + chemiosmosis) produces ~26-28 ATP. Glycolysis nets 2 ATP, Krebs cycle 2 ATP (via GTP). Fermentation yields only 2 ATP net."
  },
  {
    q: "What is the role of helicase in DNA replication?",
    options: [
      "Unwinds DNA",
      "Synthesizes RNA primer",
      "Joins Okazaki fragments",
      "Proofreads DNA"
    ],
    answer: 0,
    explanation: "Helicase unwinds DNA double helix at replication fork. Primase synthesizes RNA primers. DNA polymerase synthesizes new strand. Ligase joins Okazaki fragments. DNA polymerase also proofreads (3'→5' exonuclease activity)."
  },
  {
    q: "In a food chain, which trophic level has the greatest biomass?",
    options: [
      "Producers",
      "Primary consumers",
      "Secondary consumers",
      "Tertiary consumers"
    ],
    answer: 0,
    explanation: "Energy pyramid: Producers (plants) have greatest biomass. Only ~10% energy transfers between trophic levels (10% rule). Biomass decreases up pyramid. This limits food chain length (typically 3-4 levels)."
  },
  {
    q: "Which blood vessels have valves to prevent backflow?",
    options: [
      "Veins",
      "Arteries",
      "Capillaries",
      "Arterioles"
    ],
    answer: 0,
    explanation: "Veins have valves to prevent backflow, especially in limbs against gravity. Arteries have thick muscular walls for high pressure. Capillaries have thin walls for exchange. Venules collect from capillaries."
  },
  {
    q: "What is the primary function of the Calvin cycle?",
    options: [
      "Fix carbon dioxide",
      "Split water",
      "Produce oxygen",
      "Make ATP"
    ],
    answer: 0,
    explanation: "Calvin cycle (light-independent reactions) fixes CO₂ into organic molecules (G3P). Uses ATP and NADPH from light reactions. Occurs in stroma. Water splitting and O₂ production occur in light reactions (photosystem II)."
  },
  {
    q: "Which is an example of negative feedback?",
    options: [
      "Thermoregulation",
      "Childbirth contractions",
      "Fruit ripening",
      "Blood clotting"
    ],
    answer: 0,
    explanation: "Negative feedback reverses changes (homeostasis). Thermoregulation: high temp → sweating; low temp → shivering. Positive feedback amplifies changes: childbirth (oxytocin), fruit ripening (ethylene), blood clotting (platelets)."
  },
  {
    q: "A population with 16% homozygous recessive individuals is in Hardy-Weinberg equilibrium. What is the frequency of the dominant allele?",
    options: [
      "0.6",
      "0.4",
      "0.36",
      "0.16"
    ],
    answer: 0,
    explanation: "q² = 0.16 → q = 0.4 (recessive allele). p + q = 1 → p = 0.6 (dominant allele). Homozygous dominant = p² = 0.36. Heterozygous = 2pq = 0.48. Hardy-Weinberg requires: large population, random mating, no selection/mutation/migration."
  },
  {
    q: "Which organelle modifies and packages proteins for secretion?",
    options: [
      "Golgi apparatus",
      "Rough ER",
      "Smooth ER",
      "Lysosome"
    ],
    answer: 0,
    explanation: "Protein pathway: ribosomes (synthesis) → rough ER (folding/modification) → vesicles → Golgi (sorting/packaging) → vesicles → secretion or lysosomes. Smooth ER makes lipids/detoxifies. Lysosomes digest materials."
  },
  {
    q: "What type of symbiotic relationship benefits both species?",
    options: [
      "Mutualism",
      "Commensalism",
      "Parasitism",
      "Predation"
    ],
    answer: 0,
    explanation: "Mutualism: both benefit (flowers/bees). Commensalism: one benefits, other unaffected (barnacles/whales). Parasitism: one benefits, other harmed (tapeworms/humans). Predation: one kills/eats other (lion/gazelle)."
  },
  {
    q: "During which process does crossing over occur?",
    options: [
      "Prophase I",
      "Metaphase I",
      "Anaphase I",
      "Prophase II"
    ],
    answer: 0,
    explanation: "Crossing over occurs during prophase I of meiosis. Homologous chromosomes pair (synapsis), form chiasmata, exchange genetic material. Increases genetic diversity. Doesn't occur in mitosis or meiosis II."
  }
];

// DOM elements
const questionsContainer = document.getElementById('questions-container');
const submitBtn = document.getElementById('submitBtn');
const restartBtn = document.getElementById('restartBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resultsContainer = document.getElementById('results-container');
const messageEl = document.getElementById('message');
const startBtn = document.getElementById('startBtn');
const startScreen = document.getElementById('startScreen');
const quizContent = document.getElementById('quizContent');
const progressFill = document.getElementById('progressFill');
const currentQuestionEl = document.getElementById('currentQuestion');
const quizTimer = document.getElementById('quizTimer');

// Quiz state
let currentQuestionIndex = 0;
let userAnswers = new Array(questions.length).fill(-1);
let quizSubmitted = false;
let timeLeft = 1800; // 30 minutes in seconds
let timerInterval;

// Shuffle questions and options
function shuffleQuestions() {
    const shuffledQuestions = questions.map(q => {
        const indices = [0, 1, 2, 3];
        // Fisher-Yates shuffle
        for (let i = indices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [indices[i], indices[j]] = [indices[j], indices[i]];
        }
        
        return {
            ...q,
            shuffledOptions: indices.map(i => q.options[i]),
            correctAnswerIndex: indices.indexOf(q.answer)
        };
    });
    
    // Shuffle the questions themselves
    for (let i = shuffledQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffledQuestions[i], shuffledQuestions[j]] = [shuffledQuestions[j], shuffledQuestions[i]];
    }
    
    return shuffledQuestions;
}

let currentQuestions = [];

// Initialize quiz
function initQuiz() {
    currentQuestions = shuffleQuestions();
    currentQuestionIndex = 0;
    quizSubmitted = false;
    userAnswers = new Array(currentQuestions.length).fill(-1);
    timeLeft = 1800;
    
    resultsContainer.style.display = 'none';
    messageEl.style.display = 'none';
    submitBtn.style.display = 'none';
    prevBtn.style.display = 'inline-block';
    nextBtn.style.display = 'inline-block';
    
    updateProgressBar();
    startTimer();
    renderQuestion();
}

// Start timer
function startTimer() {
    clearInterval(timerInterval);
    updateTimerDisplay();
    
    timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            if (!quizSubmitted) {
                showMessage("Time's up! Submitting your quiz...", 'error');
                setTimeout(checkAnswers, 1000);
            }
        }
    }, 1000);
}

// Update timer display
function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    quizTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Color code for last 5 minutes
    if (timeLeft <= 300) {
        quizTimer.style.color = 'var(--error)';
        quizTimer.style.fontWeight = '600';
    }
}

// Update progress bar
function updateProgressBar() {
    const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
    progressFill.style.width = `${progress}%`;
    currentQuestionEl.textContent = currentQuestionIndex + 1;
}

// Render current question
function renderQuestion() {
    if (!currentQuestions.length) return;
    
    const question = currentQuestions[currentQuestionIndex];
    
    let optionsHTML = '';
    question.shuffledOptions.forEach((option, optionIndex) => {
        const isSelected = userAnswers[currentQuestionIndex] === optionIndex;
        const optionId = `q${currentQuestionIndex}_${optionIndex}`;
        const labels = ['A', 'B', 'C', 'D'];
        
        optionsHTML += `
            <div class="option ${isSelected ? 'selected' : ''}" data-index="${currentQuestionIndex}" data-option="${optionIndex}">
                <div class="option-label">${labels[optionIndex]}.</div>
                <div class="option-content">${option}</div>
                <input type="radio" id="${optionId}" name="q${currentQuestionIndex}" ${isSelected ? 'checked' : ''}>
            </div>
        `;
    });
    
    questionsContainer.innerHTML = `
        <div class="question-card animate-fadeIn">
            <div class="question-number">${currentQuestionIndex + 1}</div>
            <div class="question-text">${question.q}</div>
            <div class="options-container">${optionsHTML}</div>
        </div>
    `;
    
    // Update button states
    prevBtn.disabled = currentQuestionIndex === 0;
    nextBtn.textContent = currentQuestionIndex === currentQuestions.length - 1 ? 'Final Review' : 'Next';
    submitBtn.style.display = currentQuestionIndex === currentQuestions.length - 1 ? 'inline-block' : 'none';
    
    // Add event listeners to options
    document.querySelectorAll('.option').forEach(option => {
        option.addEventListener('click', function() {
            if (quizSubmitted) return;
            
            const questionIndex = parseInt(this.dataset.index);
            const optionIndex = parseInt(this.dataset.option);
            
            const questionOptions = document.querySelectorAll(`.option[data-index="${questionIndex}"]`);
            questionOptions.forEach(opt => opt.classList.remove('selected'));
            
            this.classList.add('selected');
            
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
            
            userAnswers[questionIndex] = optionIndex;
        });
    });
    
    updateProgressBar();
}

// Next question
function nextQuestion() {
    if (currentQuestionIndex < currentQuestions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
    } else {
        // At last question
        window.scrollTo({ top: 0, behavior: 'smooth' });
        showMessage("Final question. Review carefully before submitting.", 'success');
    }
}

// Previous question
function prevQuestion() {
    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        renderQuestion();
    }
}

// Check answers
function checkAnswers() {
    const unanswered = userAnswers.filter(answer => answer === -1).length;
    
    if (unanswered > 0) {
        if (!confirm(`You have ${unanswered} unanswered questions. Submit anyway?`)) {
            return;
        }
    }
    
    clearInterval(timerInterval);
    
    let score = 0;
    let resultsHTML = '';
    
    currentQuestions.forEach((question, index) => {
        const userAnswerIndex = userAnswers[index];
        const isCorrect = userAnswerIndex === question.correctAnswerIndex;
        
        if (isCorrect) {
            score++;
        }
        
        const labels = ['A', 'B', 'C', 'D'];
        const userAnswer = userAnswerIndex === -1 ? 'Not answered' : 
            `${labels[userAnswerIndex]}: ${question.shuffledOptions[userAnswerIndex]}`;
        const correctAnswer = `${labels[question.correctAnswerIndex]}: ${question.shuffledOptions[question.correctAnswerIndex]}`;
        
        resultsHTML += `
            <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border);">
                <div><strong>Question ${index + 1}:</strong> ${question.q}</div>
                <div style="margin-top: 0.5rem;"><strong style="color: ${userAnswerIndex === question.correctAnswerIndex ? 'var(--success)' : 'var(--error)'}">Your answer:</strong> ${userAnswer}</div>
                <div><strong>Correct answer:</strong> ${correctAnswer}</div>
                <div style="margin-top: 0.5rem; background: #f0f8ff; padding: 0.75rem; border-radius: 0.5rem; font-size: 0.9rem;">
                    <strong>Explanation:</strong> ${question.explanation}
                </div>
            </div>
        `;
    });
    
    const percentage = (score / currentQuestions.length) * 100;
    let grade = '';
    let feedback = '';
    
    if (percentage >= 85) {
        grade = '5 (Expert Level)';
        feedback = 'Exceptional! You demonstrate mastery of college-level biology concepts.';
    } else if (percentage >= 70) {
        grade = '4 (Advanced)';
        feedback = 'Strong performance! You have excellent understanding of complex biological systems.';
    } else if (percentage >= 55) {
        grade = '3 (Proficient)';
        feedback = 'Good work! You understand advanced concepts but should review specific mechanisms.';
    } else if (percentage >= 40) {
        grade = '2 (Developing)';
        feedback = 'Needs improvement. Focus on molecular genetics, signaling pathways, and cellular processes.';
    } else {
        grade = '1 (Basic)';
        feedback = 'Substantial review needed. Start with fundamental concepts before tackling advanced topics.';
    }
    
    resultsContainer.style.display = 'block';
    resultsContainer.innerHTML = `
        <div class="score-display">Score: ${score} / ${currentQuestions.length} (${percentage.toFixed(1)}%)</div>
        <div style="text-align: center; margin-bottom: 1.5rem; padding: 1rem; background: white; border-radius: 0.5rem; box-shadow: var(--shadow);">
            <div style="font-size: 1.2rem; color: var(--secondary); margin-bottom: 0.5rem;">AP Score Equivalent: ${grade}</div>
            <div>${feedback}</div>
        </div>
        <h3 style="margin-bottom: 1rem; color: var(--secondary);">Detailed Analysis:</h3>
        ${resultsHTML}
        <div style="text-align: center; margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-light);">
            <strong>Recommendation:</strong> Focus review on questions answered incorrectly. Use official College Board resources, AP Classroom materials, and reputable AP review books for targeted practice.
        </div>
    `;
    
    // Scroll to results
    setTimeout(() => {
        resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }, 500);
    
    quizSubmitted = true;
    submitBtn.style.display = 'none';
    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
    
    showMessage(`Quiz submitted! Score: ${score}/${currentQuestions.length}`, 'success');
}

// Show message
function showMessage(text, type) {
    messageEl.textContent = text;
    messageEl.className = `message message-${type}`;
    messageEl.style.display = 'block';
    
    if (type !== 'error') {
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 4000);
    }
}

// Event listeners
startBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    quizContent.style.display = 'block';
    initQuiz();
});

prevBtn.addEventListener('click', prevQuestion);
nextBtn.addEventListener('click', nextQuestion);
submitBtn.addEventListener('click', checkAnswers);

restartBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to restart? All progress will be lost.')) {
        initQuiz();
        showMessage('Quiz restarted. Focus on the details!', 'success');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (!quizSubmitted) {
        if (e.key === 'ArrowLeft') {
            if (currentQuestionIndex > 0) prevQuestion();
        } else if (e.key === 'ArrowRight') {
            if (currentQuestionIndex < currentQuestions.length - 1) nextQuestion();
        } else if (e.key >= 'a' && e.key <= 'd') {
            const optionIndex = e.key.charCodeAt(0) - 97;
            if (optionIndex >= 0 && optionIndex <= 3) {
                userAnswers[currentQuestionIndex] = optionIndex;
                renderQuestion();
            }
        } else if (e.key === 'Enter' && currentQuestionIndex === currentQuestions.length - 1) {
            checkAnswers();
        }
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    quizContent.style.display = 'none';
    startScreen.style.display = 'block';
});
</script>

</body>
</html>
