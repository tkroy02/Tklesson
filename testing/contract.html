
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tklesson - Tutor Employment Contract</title>
    <!-- Add Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .contract-container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            position: relative;
        }
        
        .header {
            text-align: center;
            border-bottom: 4px solid #3498db;
            padding-bottom: 30px;
            margin-bottom: 30px;
            background: linear-gradient(to right, #f8f9fa, white);
            border-radius: 8px;
            padding: 30px;
        }
        
        .logo {
            font-size: 2.8em;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .logo span {
            color: #3498db;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .contract-title {
            color: #2c3e50;
            margin: 25px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.8em;
        }
        
        .section {
            margin-bottom: 35px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .section-title {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .section-content {
            padding-left: 10px;
        }
        
        .clause {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .clause-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .clause-title::before {
            content: "‚Ä¢";
            color: #3498db;
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .highlight {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .important-note {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .form-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 10px;
            margin: 25px 0;
            border: 2px dashed #dee2e6;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .signature-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 3px solid #eee;
        }
        
        .signature-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }
        
        .signature-field {
            padding: 25px;
            border: 3px dashed #adb5bd;
            border-radius: 8px;
            min-height: 180px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .signature-field:hover {
            border-color: #3498db;
            background: #f8fafc;
        }
        
        .signature-field.signed {
            border: 3px solid #27ae60;
            background: #f0fff4;
        }
        
        .signature-field.first-signer {
            cursor: default;
            border: 3px solid #3498db;
            background: #e3f2fd;
        }
        
        .signature-field.first-signer:hover {
            background: #e3f2fd;
            border-color: #3498db;
        }
        
        .date-field {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .final-step-section {
            text-align: center;
            margin-top: 40px;
            padding: 40px;
            background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%);
            border-radius: 12px;
            border: 3px solid #3498db;
        }
        
        .print-button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px 10px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .print-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }
        
        .email-button {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 20px 10px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .email-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            font-weight: 500;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .payment-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .payment-option-btn {
            padding: 12px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .payment-option-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .payment-option-btn:hover:not(.active) {
            background: #f8f9fa;
        }
        
        .payment-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .payment-section.active {
            display: block;
        }
        
        .legal-email-address {
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.2em;
            margin: 15px auto;
            display: inline-block;
            border: 2px solid #3498db;
        }
        
        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .step-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-top: 5px solid #3498db;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin: 0 auto 15px;
        }
        
        .email-template-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .first-signer-label {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .second-signer-label {
            background: #27ae60;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .contract-container {
                box-shadow: none;
                padding: 20px;
            }
            
            .print-button,
            .email-button,
            .signature-field,
            .payment-option-btn,
            .final-step-section {
                display: none !important;
            }
            
            .form-input {
                border: none;
                padding: 0;
                background: transparent;
            }
            
            .payment-section {
                display: block !important;
            }
            
            /* Ensure signatures print correctly */
            .signature-field.first-signer,
            .signature-field.signed {
                display: flex !important;
                border: 2px solid #000 !important;
                background: white !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        @media (max-width: 768px) {
            .contract-container {
                padding: 20px;
            }
            
            .form-row,
            .signature-box,
            .steps-container {
                grid-template-columns: 1fr;
            }
            
            .logo {
                font-size: 2em;
            }
            
            .payment-toggle {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="contract-container">
        <div class="header">
            <div class="logo">TK<span>LESSON</span></div>
            <div class="subtitle">Educational Tutoring Platform</div>
            <h1>TUTOR INDEPENDENT CONTRACTOR AGREEMENT</h1>
            <p>Effective Date: <span id="current-date"></span></p>
        </div>
        
        <!-- Data Entry Form -->
        <div class="form-section">
            <h2 class="section-title">CONTRACTOR INFORMATION</h2>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Full Legal Name *</label>
                    <input type="text" class="form-input" id="contractor-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-input" id="contractor-email" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" class="form-input" id="contractor-phone" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Emergency Contact Name & Phone</label>
                    <input type="text" class="form-input" id="emergency-contact" placeholder="Name & Phone">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Full Address *</label>
                <input type="text" class="form-input" id="contractor-address" required>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Country of Residence *</label>
                    <select class="form-input" id="country-residence" required onchange="updatePaymentOptions()">
                        <option value="">Select Country</option>
                        <option value="CA">Canada</option>
                        <option value="US">United States</option>
                        <option value="other">Other International</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Social Insurance Number (SIN) or Tax ID</label>
                    <input type="text" class="form-input" id="contractor-tax-id" 
                           placeholder="SIN (Canada) or Tax ID (International)">
                    <small style="color: #666; font-size: 0.9em; display: block; margin-top: 5px;">
                        Required for tax reporting if annual earnings exceed $500 (Canada) or equivalent threshold.
                    </small>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Primary Subject(s) to Tutor *</label>
                    <input type="text" class="form-input" id="primary-subjects" required placeholder="e.g., Mathematics, Physics, Chemistry">
                </div>
                <div class="form-group">
                    <label class="form-label">Highest Education Level *</label>
                    <select class="form-input" id="education-level" required>
                        <option value="">Select Education Level</option>
                        <option value="high_school">High School Diploma</option>
                        <option value="bachelors">Bachelor's Degree</option>
                        <option value="masters">Master's Degree</option>
                        <option value="phd">PhD</option>
                        <option value="current_student">Current University Student</option>
                    </select>
                </div>
            </div>
            
            <!-- Age Verification -->
            <div class="form-group">
                <div style="padding: 20px; background: #f0f8ff; border-radius: 8px; border: 2px solid #3498db;">
                    <input type="checkbox" id="age-verification" required 
                           style="margin-right: 12px; transform: scale(1.3); vertical-align: middle;">
                    <label for="age-verification" style="font-weight: 600; cursor: pointer; font-size: 1.05em;">
                        ‚úÖ <strong>Age Verification:</strong> I confirm I am 18 years of age or older and legally eligible to work as a tutor *
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Payment Information -->
        <div class="form-section">
            <h3 class="section-title">Payment Information</h3>
            
            <div class="important-note">
                <p><strong>Payment Methods:</strong></p>
                <p>üá®üá¶ <strong>Canadian Tutors:</strong> Direct bank deposit (no fees)</p>
                <p>üá∫üá∏üåé <strong>US & International Tutors:</strong> PayPal (3% transaction fee applies)</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Select Payment Method Based on Your Country *</label>
                <div class="payment-toggle" id="payment-toggle">
                    <button type="button" class="payment-option-btn active" data-payment="canadian" id="btn-canadian">
                        üá®üá¶ Canadian Bank
                    </button>
                    <button type="button" class="payment-option-btn" data-payment="paypal" id="btn-paypal">
                        üåé PayPal (International)
                    </button>
                </div>
            </div>
            
            <!-- Canadian Banking -->
            <div class="payment-section active" id="payment-canadian">
                <h4 style="color: #3498db; margin-bottom: 20px;">Canadian Banking Information</h4>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Bank Name *</label>
                        <select class="form-input" id="bank-name" required>
                            <option value="">Select Your Bank</option>
                            <option value="td">TD Canada Trust (004)</option>
                            <option value="rbc">RBC Royal Bank (003)</option>
                            <option value="scotiabank">Scotiabank (002)</option>
                            <option value="bmo">BMO Bank of Montreal (001)</option>
                            <option value="cibc">CIBC (010)</option>
                            <option value="hsbc">HSBC Canada (016)</option>
                            <option value="national">National Bank (006)</option>
                            <option value="tangerine">Tangerine (614)</option>
                            <option value="other">Other Bank</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Account Holder Name *</label>
                        <input type="text" class="form-input" id="account-holder" 
                               placeholder="Exactly as it appears on bank account" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Institution Number (3 digits) *</label>
                        <input type="text" class="form-input" id="institution-number" 
                               pattern="[0-9]{3}" maxlength="3" placeholder="004" required>
                        <small style="color: #666;">3-digit bank code (ex: 004 for TD)</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Transit Number (5 digits) *</label>
                        <input type="text" class="form-input" id="transit-number" 
                               pattern="[0-9]{5}" maxlength="5" placeholder="12345" required>
                        <small style="color: #666;">5-digit branch number</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Account Number (7-12 digits) *</label>
                        <input type="text" class="form-input" id="account-number" 
                               pattern="[0-9]{7,12}" placeholder="1234567" required>
                        <small style="color: #666;">Your personal account number</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Account Type *</label>
                        <select class="form-input" id="account-type" required>
                            <option value="">Select Account Type</option>
                            <option value="chequing">Chequing Account</option>
                            <option value="savings">Savings Account</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Full Bank Number </label>
                    <input type="text" class="form-input" id="full-bank-number" readonly 
                           style="background: #f8f9fa; font-weight: bold;">
                    <small style="color: #666;">Format: Institution-Transit-Account</small>
                </div>
            </div>
            
            <!-- PayPal for International -->
            <div class="payment-section" id="payment-paypal">
                <h4 style="color: #3498db; margin-bottom: 20px;">PayPal Payment Information</h4>
                
                <div class="form-group">
                    <label class="form-label">PayPal Email Address *</label>
                    <input type="email" class="form-input" id="paypal-email" 
                           placeholder="Your PayPal email address">
                    <small style="color: #666;">Must be a verified PayPal account</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Currency Preference *</label>
                    <select class="form-input" id="paypal-currency" required>
                        <option value="USD">US Dollars (USD)</option>
                        <option value="CAD">Canadian Dollars (CAD)</option>
                        <option value="EUR">Euros (EUR)</option>
                        <option value="GBP">British Pounds (GBP)</option>
                    </select>
                </div>
                
                <div class="important-note">
                    <p><strong>PayPal Payment Terms:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>3% transaction fee applies to all PayPal payments</li>
                        <li>Payments are processed within 3 business days</li>
                        <li>You are responsible for any PayPal account fees</li>
                        <li>Ensure your PayPal account can receive international payments</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                        <input type="checkbox" id="paypal-fee-acknowledgment">
                        <label for="paypal-fee-acknowledgment" style="margin-left: 8px;">
                            I acknowledge that a 3% transaction fee will be deducted from PayPal payments to cover processing costs.
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2 class="contract-title">AGREEMENT TERMS</h2>
            
            <div class="clause">
                <div class="clause-title">1. Parties to This Agreement</div>
                <div class="section-content">
                    <p>This Independent Contractor Agreement ("Agreement") is entered into between:</p>
                    <p><strong>Tklesson</strong> ("Platform"), a sole proprietorship operating the Tklesson educational platform,</p>
                    <p>and</p>
                    <p><strong><span id="display-name">[Contractor Name]</span></strong> ("Contractor"),</p>
                    <p>collectively referred to as "Parties."</p>
                </div>
            </div>
            
            <div class="important-note">
                <stron‚ö†Ô∏è IMPORTANT:</strong> This agreement establishes an independent contractor relationship, NOT an employment relationship. Contractors are responsible for their own taxes, insurance, and business expenses.
            </div>
            
            <div class="clause">
                <div class="clause-title">2. Independent Contractor Status</div>
                <div class="section-content">
                    <p>Contractor is engaged as an independent contractor. This Agreement does not create an employer-employee relationship. Contractor:</p>
                    <ul>
                        <li>Is responsible for all applicable federal, state/provincial, and local taxes</li>
                        <li>Will not receive employee benefits (health insurance, retirement, etc.)</li>
                        <li>Has control over how tutoring services are performed</li>
                        <li>May provide services to other clients/platforms</li>
                        <li>Is responsible for their own equipment and workspace</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">3. Services to Be Performed</div>
                <div class="section-content">
                    <p>Contractor agrees to provide online tutoring services through the Tklesson platform, including:</p>
                    <ul>
                        <li>Conducting scheduled tutoring sessions via the platform's video system</li>
                        <li>Providing academic support in designated subject areas</li>
                        <li>Creating and/or using appropriate educational materials</li>
                        <li>Maintaining professional conduct during all sessions</li>
                        <li>Completing session notes and progress reports as required</li>
                        <li>Adhering to scheduled session times and cancellation policies</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">4. Compensation</div>
                <div class="section-content">
                    <div class="highlight">
                        <p><strong>Hourly Rate:</strong> $40.00 USD per hour of actual tutoring time</p>
                        <p><strong>Payment Schedule:</strong> Bi-weekly payments</p>
                        <p><strong>Session Minimum:</strong> 1 hour per session</p>
                        <p><strong>Payment Methods:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Canadian tutors: Direct bank deposit (no fees)</li>
                            <li>International tutors: PayPal (3% transaction fee applies)</li>
                        </ul>
                    </div>
                    <ul>
                        <li>Payment is only for completed, verified tutoring sessions</li>
                        <li>Contractor receives $40.00 USD per hour for all completed sessions</li>
                        <li>No payment for preparation time, materials creation, or administrative work</li>
                        <li>Late or missed payments must be reported within 30 days</li>
                        <li>Payment processing occurs every 1st and 15th of the month</li>
                        <li>No platform fees deducted from tutor compensation</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">5. Qualifications & Requirements</div>
                <div class="section-content">
                    <p>Contractor represents and warrants that they:</p>
                    <ul>
                        <li>Hold at minimum a Bachelor's degree in relevant field (or current enrollment)</li>
                        <li>Have necessary expertise in subjects they tutor</li>
                        <li>Maintain a professional workspace with reliable internet connection</li>
                        <li>Possess necessary computer equipment and webcam</li>
                        <li>Maintain any required teaching certifications (if applicable)</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">6. Session Policies</div>
                <div class="section-content">
                    <ul>
                        <li><strong>Scheduling:</strong> Sessions booked exclusively through Tklesson platform</li>
                        <li><strong>Cancellation by Tutor:</strong> Must provide 24+ hours notice or provide makeup session</li>
                        <li><strong>Late Arrival:</strong> Sessions shorter than 15 minutes are cancelled without pay</li>
                        <li><strong>No-Show:</strong> Three no-shows may result in contract termination</li>
                        <li><strong>Session Recording:</strong> Sessions may be recorded for quality assurance</li>
                        <li><strong>Makeup Sessions:</strong> Required if tutor cancels within 24-hour window</li>
                        <li><strong>Minimum Session:</strong> 1 hour per booking</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">7. Code of Professional Conduct</div>
                <div class="section-content">
                    <p>Contractor agrees to:</p>
                    <ul>
                        <li>Maintain professional boundaries with students at all times</li>
                        <li>Never share personal contact information with students</li>
                        <li>Use only platform-approved communication channels</li>
                        <li>Dress appropriately for video sessions</li>
                        <li>Maintain a professional, distraction-free background</li>
                        <li>Never engage in discriminatory behavior or harassment</li>
                        <li>Report any student safety concerns immediately</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">8. Confidentiality & Privacy</div>
                <div class="section-content">
                    <p>Contractor agrees to protect student and company information:</p>
                    <ul>
                        <li>Never share student information with third parties</li>
                        <li>Comply with all applicable privacy laws (FERPA, PIPEDA, etc.)</li>
                        <li>Secure all student data and materials</li>
                        <li>Delete student information when no longer needed</li>
                        <li>Report any data breaches immediately</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">9. Intellectual Property</div>
                <div class="section-content">
                    <ul>
                        <li><strong>Platform IP:</strong> Tklesson owns all platform software, designs, and branding</li>
                        <li><strong>Tutor-Created Materials:</strong> Tutors retain full ownership of materials they create</li>
                        <li><strong>Student Work:</strong> Student work remains property of the student</li>
                        <li><strong>Prohibited Use:</strong> May not use platform materials for competing services</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">10. Term & Termination</div>
                <div class="section-content">
                    <ul>
                        <li><strong>Term:</strong> This agreement begins on acceptance and continues until terminated</li>
                        <li><strong>Termination by Platform:</strong> May terminate with 30 days notice, or immediately for cause</li>
                        <li><strong>Termination by Contractor:</strong> May terminate with 30 days written notice</li>
                        <li><strong>Immediate Termination Causes:</strong> Fraud, misconduct, safety violations, breach of contract</li>
                        <li><strong>Post-Termination:</strong> All outstanding payments will be processed within 30 days</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">11. Liability & Indemnification</div>
                <div class="section-content">
                    <ul>
                        <li>Contractor carries sole liability for their professional services</li>
                        <li>Tklesson is not liable for Contractor's actions, errors, or omissions</li>
                        <li>Contractor agrees to indemnify Tklesson against claims arising from their services</li>
                        <li>Contractor recommended to carry professional liability insurance</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">12. Dispute Resolution</div>
                <div class="section-content">
                    <ul>
                        <li><strong>Governing Law:</strong> Laws of Ontario, Canada</li>
                        <li><strong>Mediation:</strong> Parties agree to mediate disputes before litigation</li>
                        <li><strong>Venue:</strong> Toronto, Ontario for any legal proceedings</li>
                        <li><strong>Legal Fees:</strong> Prevailing party entitled to reasonable legal fees</li>
                    </ul>
                </div>
            </div>
            
            <div class="clause">
                <div class="clause-title">13. General Provisions</div>
                <div class="section-content">
                    <ul>
                        <li><strong>Entire Agreement:</strong> This document constitutes the complete agreement</li>
                        <li><strong>Modifications:</strong> Changes must be in writing and signed by both parties</li>
                        <li><strong>Severability:</strong> If any clause is invalid, remainder remains in effect</li>
                        <li><strong>Assignment:</strong> Contractor may not assign this agreement without consent</li>
                        <li><strong>Notices:</strong> All notices via email to registered addresses</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="signature-section">
            <h2 class="contract-title">ELECTRONIC SIGNATURES</h2>
            
            <p>By signing below, the parties acknowledge they have read, understood, and agree to all terms of this Agreement.</p>
            
            <div class="signature-box">
                <!-- FIRST SIGNER: Tklesson (always signed, today's date) -->
                <div>
                    <div class="first-signer-label">First Signer</div>
                    <h3 class="section-title">FOR TKLESSON</h3>
                    <div class="signature-field first-signer" id="company-signature">
                        <!-- Content will be filled by JavaScript -->
                    </div>
                    <div class="date-field">
                        <p><strong>Name:</strong> Tklesson Management</p>
                        <p><strong>Title:</strong> Platform Operator</p>
                        <p><strong>Date:</strong> <span id="company-date"></span></p>
                        <p><strong>Status:</strong> First Signatory - Offer Extended</p>
                    </div>
                </div>
                
                <!-- SECOND SIGNER: Contractor (clicks to sign) -->
                <div>
                    <div class="second-signer-label">Second Signer</div>
                    <h3 class="section-title">FOR CONTRACTOR</h3>
                    <div class="signature-field" id="contractor-signature">
                        <p>Click here to sign as Contractor (Second Signatory)</p>
                    </div>
                    <div class="date-field">
                        <p><strong>Print Name:</strong> <span id="display-signature-name">[Your Name Will Appear Here]</span></p>
                        <p><strong>Date:</strong> <span id="contractor-date"></span></p>
                        <p><strong>Contract ID:</strong> <span id="contract-id-display">Auto-generated upon completion</span></p>
                        <p><strong>Status:</strong> <span id="contractor-status">Awaiting Signature</span></p>
                    </div>
                </div>
            </div>
            
            <!-- Signing Order Note -->
            <div class="important-note" style="margin-top: 30px;">
                <strong>Signing Order:</strong>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>First Signer:</strong> Tklesson (pre-signed - extends offer)</li>
                    <li><strong>Second Signer:</strong> Contractor (signs to accept offer)</li>
                    <li><strong>Agreement Effective:</strong> Upon contractor's signature</li>
                </ol>
                <p style="margin-top: 10px; font-style: italic;">
                    This agreement originates from Tklesson and becomes binding when countersigned by the contractor.
                </p>
            </div>
            
            <!-- Privacy & Data Consent -->
            <div class="form-group" style="margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 8px;">
                <input type="checkbox" id="privacy-consent" required 
                       style="margin-right: 10px; transform: scale(1.2);">
                <label for="privacy-consent" style="font-weight: 600; cursor: pointer;">
                    ‚úÖ <strong>Data Privacy Consent:</strong> I consent to the collection and use of my personal information 
                    for contract administration, payment processing, and tax reporting purposes. I understand my tax ID 
                    will be stored securely and used only for tax reporting as required by law.
                </label>
            </div>
            
            <!-- Final Agreement -->
            <div class="form-group" style="margin-top: 20px; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 2px solid #27ae60;">
                <input type="checkbox" id="final-agreement" required 
                       style="margin-right: 10px; transform: scale(1.2);">
                <label for="final-agreement" style="font-weight: 600; cursor: pointer; font-size: 1.1em;">
                    ‚úÖ <strong>Final Agreement:</strong> I have read and agree to all terms and conditions of this Independent Contractor Agreement. 
                    I understand that by signing as the second signatory, I am accepting the offer extended by Tklesson.
                </label>
            </div>
        </div>
        
        <!-- FINAL SUBMISSION STEPS -->
        <div class="final-step-section" id="final-step-section" style="display: none;">
            <h2 style="color: #2c3e50; margin-bottom: 30px;">üìã FINAL STEP: SUBMIT YOUR CONTRACT</h2>
            
            <p style="font-size: 1.1em; margin-bottom: 30px; color: #2c3e50;">
                Your contract is complete! Please follow these steps to submit it:
            </p>
            
            <div class="steps-container">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>Save Your Contract</h3>
                    <p>Print your contract or save it as a PDF file</p>
                    <div style="margin-top: 15px;">
                        <button class="print-button" onclick="window.print()">
                            üñ®Ô∏è Print / Save as PDF
                        </button>
                    </div>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                        In the print dialog, select "Save as PDF" to create a digital copy.
                    </p>
                </div>
                
                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Email to Tklesson</h3>
                    <p>Send your signed contract from your email address</p>
                    <div style="margin-top: 15px;">
                        <div class="legal-email-address">info@tklesson.com</div>
                        <button class="email-button" onclick="openEmailWithTemplate()">
                            üìß Open Email Template
                        </button>
                    </div>
                </div>
                
                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>Wait for Confirmation</h3>
                    <p>We'll review and respond within 2 business days</p>
                    <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        <p><strong>Contract ID:</strong> <span id="final-contract-id"></span></p>
                        <p><strong>Submission Date:</strong> <span id="submission-date"></span></p>
                        <p><strong>Signed by:</strong> You (Second Signer)</p>
                    </div>
                </div>
            </div>
            
            <!-- Email Template -->
            <div style="margin-top: 30px; text-align: left;">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">üìù Suggested Email Template:</h4>
                <div class="email-template-box" id="email-template">
Subject: Tklesson Tutor Contract Submission - [Your Name]

Dear Tklesson Team,

Please find attached my completed and signed Tutor Independent Contractor Agreement.

Contract Details:
- Name: [Your Full Name]
- Email: [Your Email Address]
- Phone: [Your Phone Number]
- Contract ID: [Contract ID]
- Date Signed: [Today's Date]

I have reviewed and agreed to all terms and conditions outlined in the contract.

Please confirm receipt and next steps.

Sincerely,

[Your Name]
                </div>
                <button class="print-button" onclick="copyEmailTemplate()" style="margin-top: 10px; background: #6c757d;">
                    üìã Copy Template to Clipboard
                </button>
            </div>
            
            <!-- Legal Note -->
            <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                <h4 style="color: #856404; margin-bottom: 10px;">‚öñÔ∏è Legal Submission Note:</h4>
                <p style="color: #856404;">
                    <strong>Contract Formation Complete:</strong> You have signed as the second signatory, accepting the offer extended by Tklesson (first signatory). 
                    Email submission creates an official timestamp and verifies your email address for the contract record.
                </p>
            </div>
        </div>
        
        <!-- Completion Button -->
        <div id="completion-button-container" style="text-align: center; margin-top: 40px; padding-top: 30px; border-top: 2px solid #eee;">
            <div class="status-message" id="status-message"></div>
            
            <button class="print-button" id="complete-contract-button" style="padding: 18px 50px; font-size: 1.2em;">
                ‚úÖ Complete & Prepare for Submission
            </button>
            
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 0.9em;">
                By clicking above, you confirm all information is correct and are ready to sign as the second party.
            </p>
        </div>
    </div>

    <script>
// IMMEDIATE AUTHENTICATION CHECK - BLOCKS ALL EXECUTION
(function() {
    'use strict';
    
    // Security Configuration
    const SECURITY_CONFIG = {
        SESSION_TIMEOUT: 8 * 60 * 60 * 1000, // 8 hours in milliseconds
        LOGIN_PAGE: 'https://www.tklesson.com/testing/contract-login.html',
        REQUIRED_FIELDS: ['tk_auth', 'tk_email', 'tk_uid'],
        MAX_SESSION_AGE: 24 * 60 * 60 * 1000 // 24 hours absolute max
    };
    
    // Function to completely block the page
    function blockPageAccess(reason) {
        // Immediately hide all content
        document.documentElement.style.display = 'none';
        
        // Clear the page
        document.body.innerHTML = `
            <div style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: white;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 999999;
                font-family: 'Segoe UI', Arial, sans-serif;
                text-align: center;
                padding: 20px;
            ">
                <div style="max-width: 500px;">
                    <div style="
                        font-size: 64px;
                        margin-bottom: 20px;
                    ">üîí</div>
                    
                    <h1 style="
                        color: #e74c3c;
                        font-size: 28px;
                        margin-bottom: 15px;
                        font-weight: 600;
                    ">Access Denied</h1>
                    
                    <p style="
                        color: #555;
                        font-size: 16px;
                        margin-bottom: 10px;
                        line-height: 1.6;
                    ">${reason}</p>
                    
                    <p style="
                        color: #7f8c8d;
                        font-size: 14px;
                        margin: 30px 0;
                    ">Redirecting to login page...</p>
                    
                    <div style="
                        width: 200px;
                        height: 4px;
                        background: #ecf0f1;
                        border-radius: 2px;
                        overflow: hidden;
                        margin: 20px auto;
                    ">
                        <div style="
                            width: 100%;
                            height: 100%;
                            background: #3498db;
                            animation: progress 2s ease-in-out;
                        "></div>
                    </div>
                    
                    <p style="
                        margin-top: 30px;
                        font-size: 14px;
                        color: #95a5a6;
                    ">
                        If you're not redirected automatically, 
                        <a href="${SECURITY_CONFIG.LOGIN_PAGE}" 
                           style="color: #3498db; text-decoration: none;">
                            click here
                        </a>
                    </p>
                </div>
            </div>
            
            <style>
                @keyframes progress {
                    from { transform: translateX(-100%); }
                    to { transform: translateX(0); }
                }
            </style>
        `;
        
        // Clear all storage
        sessionStorage.clear();
        localStorage.clear();
        
        // Redirect after delay
        setTimeout(() => {
            window.location.replace(SECURITY_CONFIG.LOGIN_PAGE);
        }, 2000);
        
        // Stop all script execution
        throw new Error('Unauthorized access blocked');
    }
    
    // Validate session data
    function validateSession() {
        // Check if all required session fields exist
        const hasAllFields = SECURITY_CONFIG.REQUIRED_FIELDS.every(
            field => sessionStorage.getItem(field)
        );
        
        if (!hasAllFields) {
            return { valid: false, reason: 'Session data incomplete' };
        }
        
        // Check authentication flag
        if (sessionStorage.getItem('tk_auth') !== 'true') {
            return { valid: false, reason: 'Invalid authentication status' };
        }
        
        // Validate email format
        const email = sessionStorage.getItem('tk_email');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            return { valid: false, reason: 'Invalid email format' };
        }
        
        // Validate UID format (Firebase UIDs are alphanumeric, 28 chars)
        const uid = sessionStorage.getItem('tk_uid');
        if (!uid || uid.length < 10) {
            return { valid: false, reason: 'Invalid user identifier' };
        }
        
        // Check session timestamp
        const loginTime = sessionStorage.getItem('tk_login_time');
        if (!loginTime) {
            return { valid: false, reason: 'Session timestamp missing' };
        }
        
        const sessionAge = Date.now() - parseInt(loginTime);
        
        // Check if session expired (8 hours)
        if (sessionAge > SECURITY_CONFIG.SESSION_TIMEOUT) {
            return { valid: false, reason: 'Session expired - please login again' };
        }
        
        // Check if session is too old (24 hours absolute max)
        if (sessionAge > SECURITY_CONFIG.MAX_SESSION_AGE) {
            return { valid: false, reason: 'Session too old - please login again' };
        }
        
        return { valid: true };
    }
    
    // Verify Firebase authentication state
    function verifyFirebaseAuth() {
        return new Promise((resolve) => {
            // Wait for Firebase to load
            const checkFirebase = setInterval(() => {
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    clearInterval(checkFirebase);
                    
                    firebase.auth().onAuthStateChanged((user) => {
                        if (user && user.emailVerified) {
                            // Verify UID matches session
                            const sessionUid = sessionStorage.getItem('tk_uid');
                            if (user.uid === sessionUid) {
                                resolve({ authenticated: true });
                            } else {
                                resolve({ 
                                    authenticated: false, 
                                    reason: 'User identifier mismatch' 
                                });
                            }
                        } else {
                            resolve({ 
                                authenticated: false, 
                                reason: user ? 'Email not verified' : 'Not authenticated with Firebase' 
                            });
                        }
                    });
                }
            }, 100);
            
            // Timeout after 5 seconds
            setTimeout(() => {
                clearInterval(checkFirebase);
                resolve({ 
                    authenticated: false, 
                    reason: 'Authentication verification timeout' 
                });
            }, 5000);
        });
    }
    
    // Prevent back button access after logout
    function preventBackButton() {
        window.history.pushState(null, '', window.location.href);
        window.onpopstate = function() {
            window.history.pushState(null, '', window.location.href);
            const isAuth = sessionStorage.getItem('tk_auth') === 'true';
            if (!isAuth) {
                window.location.replace(SECURITY_CONFIG.LOGIN_PAGE);
            }
        };
    }
    
    // Prevent page caching
    function preventCaching() {
        window.onpageshow = function(event) {
            if (event.persisted) {
                window.location.reload();
            }
        };
    }
    
    // Monitor for session tampering
    function monitorSession() {
        const originalValues = {
            auth: sessionStorage.getItem('tk_auth'),
            email: sessionStorage.getItem('tk_email'),
            uid: sessionStorage.getItem('tk_uid')
        };
        
        setInterval(() => {
            const currentAuth = sessionStorage.getItem('tk_auth');
            const currentEmail = sessionStorage.getItem('tk_email');
            const currentUid = sessionStorage.getItem('tk_uid');
            
            // Check if critical values changed
            if (currentAuth !== originalValues.auth ||
                currentEmail !== originalValues.email ||
                currentUid !== originalValues.uid) {
                blockPageAccess('Session tampering detected');
            }
            
            // Revalidate session
            const validation = validateSession();
            if (!validation.valid) {
                blockPageAccess(validation.reason);
            }
        }, 5000); // Check every 5 seconds
    }
    
    // Main security check
    async function performSecurityCheck() {
        try {
            // 1. Validate session storage
            const sessionValidation = validateSession();
            if (!sessionValidation.valid) {
                blockPageAccess(sessionValidation.reason);
                return;
            }
            
            // 2. Verify Firebase authentication (async)
            const firebaseValidation = await verifyFirebaseAuth();
            if (!firebaseValidation.authenticated) {
                blockPageAccess(firebaseValidation.reason);
                return;
            }
            
            // 3. Enable security monitoring
            preventBackButton();
            preventCaching();
            monitorSession();
            
            // 4. Update last activity timestamp
            sessionStorage.setItem('tk_last_activity', Date.now().toString());
            
            // 5. Show the page (if it was hidden)
            document.documentElement.style.display = '';
            
            console.log('‚úÖ Security check passed - Access granted');
            
        } catch (error) {
            console.error('Security check error:', error);
            blockPageAccess('Security verification failed');
        }
    }
    
    // Run security check immediately
    performSecurityCheck();
    
    // Activity monitoring - logout on inactivity
    let inactivityTimer;
    const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30 minutes
    
    function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        sessionStorage.setItem('tk_last_activity', Date.now().toString());
        
        inactivityTimer = setTimeout(() => {
            blockPageAccess('Session expired due to inactivity');
        }, INACTIVITY_TIMEOUT);
    }
    
    // Track user activity
    ['mousedown', 'keydown', 'scroll', 'touchstart'].forEach(event => {
        document.addEventListener(event, resetInactivityTimer, true);
    });
    
    resetInactivityTimer();
    
})();

// ============================================
// ADDITIONAL: Enhanced Login Page Security
// Add this to contract-login.html after successful login
// ============================================

// In the login success handler, add login timestamp:
function setSecureSession(user, email) {
    sessionStorage.setItem('tk_auth', 'true');
    sessionStorage.setItem('tk_email', email);
    sessionStorage.setItem('tk_uid', user.uid);
    sessionStorage.setItem('tk_login_time', Date.now().toString());
    sessionStorage.setItem('tk_last_activity', Date.now().toString());
    
    // Optional: Add device fingerprint
    const fingerprint = generateDeviceFingerprint();
    sessionStorage.setItem('tk_device', fingerprint);
}

function generateDeviceFingerprint() {
    // Simple device fingerprint
    const data = [
        navigator.userAgent,
        navigator.language,
        screen.width + 'x' + screen.height,
        new Date().getTimezoneOffset()
    ].join('|');
    
    // Simple hash function
    let hash = 0;
    for (let i = 0; i < data.length; i++) {
        const char = data.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash.toString(36);
}

// ============================================
// FIRESTORE SECURITY RULES
// Add these to your Firebase Console
// ============================================

/*
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Tutors collection - only authenticated users
    match /tutors/{tutorId} {
      allow read: if request.auth != null && 
                     request.auth.uid == tutorId;
      allow write: if false; // Only admin can write
    }
    
    // Contracts collection - restricted access
    match /contracts/{contractId} {
      allow create: if request.auth != null && 
                       request.auth.token.email_verified == true &&
                       request.resource.data.contractorDetails.email == request.auth.token.email;
      
      allow read: if request.auth != null && 
                     resource.data.contractorDetails.email == request.auth.token.email;
      
      allow update, delete: if false; // Only admin can modify
    }
  }
}
*/

        // ============================================
        // AUTHENTICATION CHECK - MUST BE FIRST THING
        // ============================================
        (function() {
            // Check if user is properly authenticated
            const isAuthenticated = sessionStorage.getItem('tk_auth') === 'true' && 
                                  sessionStorage.getItem('tk_email');
            
            // If NOT authenticated, redirect immediately and STOP all execution
            if (!isAuthenticated) {
                // Show blocking message
                document.body.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: white;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        z-index: 9999;
                        font-family: Arial, sans-serif;
                        text-align: center;
                        padding: 20px;
                    ">
                        <h1 style="color: #e74c3c;">‚õî Access Denied</h1>
                        <p style="margin: 20px 0;">You must be logged in to access the contract page.</p>
                        <p>Redirecting to login page...</p>
                        <p style="margin-top: 30px; font-size: 0.9em; color: #7f8c8d;">
                            If redirect doesn't happen automatically, 
                            <a href="https://www.tklesson.com/testing/contract-login.html">click here</a>
                        </p>
                    </div>
                `;
                
                // Clear any potential data and redirect
                sessionStorage.clear();
                setTimeout(() => {
                    window.location.href = 'https://www.tklesson.com/testing/contract-login.html';
                }, 2000);
                
                // Stop all further JavaScript execution
                throw new Error('Unauthorized access - redirecting to login');
            }
            
            // Check session expiration (8 hours)
            const loginTime = sessionStorage.getItem('tk_login_time');
            if (loginTime) {
                const eightHours = 8 * 60 * 60 * 1000;
                if (Date.now() - parseInt(loginTime) > eightHours) {
                    sessionStorage.clear();
                    window.location.href = 'https://www.tklesson.com/testing/contract-login.html?expired=true';
                    throw new Error('Session expired');
                }
            }
        })();

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjo5LY4EsFlX8j_8NbLUObooUsCqJM8KM",
            authDomain: "tk-scheduler.firebaseapp.com",
            projectId: "tk-scheduler",
            storageBucket: "tk-scheduler.appspot.com",
            messagingSenderId: "746606755052",
            appId: "1:746606755052:web:d7eae92976cb2f2fa9f9c9",
            measurementId: "G-Q5L607R3N7"
        };

        // Initialize Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        
        let contractId = '';
        let signatureDate = '';
        
        // Set current date for BOTH signatures
        function updateSignatureDate() {
            const now = new Date();
            signatureDate = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Set current date display
            document.getElementById('current-date').textContent = signatureDate;
            
            // Set company signature date (FIRST SIGNER - always today)
            document.getElementById('company-date').textContent = signatureDate;
            
            // Also set contractor date (will be same when they sign)
            document.getElementById('contractor-date').textContent = signatureDate;
            
            return signatureDate;
        }
        
        // Initialize company signature (FIRST SIGNER - always signed)
        function initializeCompanySignature() {
            const date = updateSignatureDate();
            
            document.getElementById('company-signature').innerHTML = `
                <div style="text-align: center;">
                    <div style="display: inline-block; border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 5px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">
                            Tklesson Management
                        </div>
                    </div>
                    <div style="font-family: 'Georgia', serif; font-size: 1.3em; color: #000; margin: 15px 0;">
                        <i>Digitally Signed</i>
                    </div>
                    <div style="color: #666; font-size: 0.95em;">
                        <strong>Date:</strong> ${date}
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 4px; font-size: 0.85em;">
                        <strong>First Signatory</strong> - Offer Extended
                    </div>
                </div>
            `;
            
            // Make company signature NOT clickable
            document.getElementById('company-signature').onclick = null;
            document.getElementById('company-signature').style.cursor = 'default';
        }
        
        // Generate unique Contract ID
        function generateContractId() {
            const prefix = 'CONTRACT';
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(Math.random() * 9000 + 1000);
            return `${prefix}-${timestamp}-${random}`;
        }
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.clear();
                window.location.href = 'https://www.tklesson.com/testing/contract-login.html';
            }
        }

        // ============================================
        // FIREBASE FUNCTIONS - Save ALL data to contracts collection
        // ============================================
        
        // Save ALL contract and payment details to contracts collection in Firestore
        async function saveAllDataToFirestore(formData) {
            try {
                if (!db) {
                    throw new Error("Firestore not initialized");
                }
                
                // Create comprehensive document for contracts collection
                const allData = {
                    contractId: contractId,
                    
                    // Contractor Information
                    contractorDetails: {
                        fullName: formData.contractorName,
                        email: formData.contractorEmail,
                        phone: formData.contractorPhone,
                        address: formData.contractorAddress,
                        emergencyContact: formData.emergencyContact,
                        taxId: formData.contractorTaxId,
                        countryResidence: formData.countryResidence,
                        primarySubjects: formData.primarySubjects,
                        educationLevel: formData.educationLevel,
                        ageVerified: formData.ageVerification
                    },
                    
                    // Contract Information
                    contractInfo: {
                        signatureDate: signatureDate,
                        status: 'signed',
                        signedBy: 'contractor',
                        termsAccepted: true,
                        privacyConsent: true,
                        finalAgreement: true
                    },
                    
                    // Payment Information
                    paymentDetails: {
                        method: formData.paymentMethod,
                        country: formData.countryResidence
                    },
                    
                    // Timestamps
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add Canadian banking details if applicable
                if (formData.paymentMethod === 'canadian') {
                    allData.paymentMethodDetails = {
                        bankName: formData.bankName,
                        accountHolder: formData.accountHolder,
                        institutionNumber: formData.institutionNumber,
                        transitNumber: formData.transitNumber,
                        accountNumber: formData.accountNumber,
                        accountType: formData.accountType,
                        fullBankNumber: formData.fullBankNumber,
                        type: 'canadian_bank'
                    };
                }
                
                // Add PayPal details if applicable
                if (formData.paymentMethod === 'paypal') {
                    allData.paymentMethodDetails = {
                        paypalEmail: formData.paypalEmail,
                        currencyPreference: formData.paypalCurrency,
                        feeAcknowledgment: formData.paypalFeeAcknowledgment,
                        type: 'paypal'
                    };
                }
                
                // Save ALL data to contracts collection
                const docRef = await db.collection('contracts').add(allData);
                
                console.log("All data saved to contracts collection with ID:", docRef.id);
                return docRef.id;
                
            } catch (error) {
                console.error("Error saving data to Firestore:", error);
                throw error;
            }
        }
        
        // ============================================
        // FORM VALIDATION & UPDATES
        // ============================================
        
        // Update display name when name is entered
        document.getElementById('contractor-name').addEventListener('input', function() {
            const name = this.value.trim();
            document.getElementById('display-name').textContent = name || '[Contractor Name]';
            document.getElementById('display-signature-name').textContent = name || '[Your Name Will Appear Here]';
            checkFormCompletion();
        });
        
        // Payment method toggle
        function setupPaymentToggle() {
            const paymentBtns = document.querySelectorAll('.payment-option-btn');
            const paymentSections = document.querySelectorAll('.payment-section');
            
            paymentBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update button states
                    paymentBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update section visibility
                    const paymentType = this.dataset.payment;
                    paymentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === `payment-${paymentType}`) {
                            section.classList.add('active');
                        }
                    });
                    
                    checkFormCompletion();
                });
            });
        }
        
        // Update payment options based on country
        function updatePaymentOptions() {
            const country = document.getElementById('country-residence').value;
            const canadianBtn = document.getElementById('btn-canadian');
            const paypalBtn = document.getElementById('btn-paypal');
            
            if (country === 'CA') {
                // Canada - show Canadian banking by default
                canadianBtn.click();
                canadianBtn.style.display = 'block';
                paypalBtn.style.display = 'block';
            } else if (country === 'US' || country === 'other') {
                // US or International - show PayPal by default
                paypalBtn.click();
                canadianBtn.style.display = 'none';
                paypalBtn.style.display = 'block';
            } else {
                // No country selected
                canadianBtn.style.display = 'block';
                paypalBtn.style.display = 'block';
            }
            
            checkFormCompletion();
        }
        
        // Bank number auto-generation
        function updateBankNumber() {
            const institution = document.getElementById('institution-number')?.value || '';
            const transit = document.getElementById('transit-number')?.value || '';
            const account = document.getElementById('account-number')?.value || '';
            
            if (institution && transit && account) {
                document.getElementById('full-bank-number').value = 
                    `${institution}-${transit}-${account}`;
            } else {
                document.getElementById('full-bank-number').value = '';
            }
            
            checkFormCompletion();
        }
        
        // ============================================
        // CONTRACTOR SIGNATURE (SECOND SIGNER)
        // ============================================
        
        // Contractor signs as second signer
        document.getElementById('contractor-signature').addEventListener('click', function() {
            const name = document.getElementById('contractor-name').value.trim();
            if (!name) {
                alert('Please enter your name in the form first.');
                document.getElementById('contractor-name').focus();
                return;
            }
            
            // Ensure date is current
            updateSignatureDate();
            
            // Show contractor signature
            this.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px; color: #2c3e50;">
                        ${name}
                    </div>
                    <div style="font-family: 'Dancing Script', cursive; font-size: 1.5em; color: #27ae60;">
                       ‚úçÔ∏è Countersigned
                    </div>
                    <div style="font-size: 0.9em; color: #7f8c8d; margin-top: 10px;">
                        ${signatureDate}
                    </div>
                    <div style="margin-top: 15px; padding: 5px 10px; background: #e8f5e9; border-radius: 4px; font-size: 0.85em;">
                        <strong>Second Signatory</strong> - Offer Accepted
                    </div>
                </div>
            `;
            this.classList.add('signed');
            
            // Update status
            document.getElementById('contractor-status').textContent = 'Signed - Offer Accepted';
            document.getElementById('contractor-status').style.color = '#27ae60';
            document.getElementById('contractor-status').style.fontWeight = 'bold';
            
            checkFormCompletion();
        });
        
        // ============================================
        // FORM COMPLETION CHECK
        // ============================================
        
        function checkFormCompletion() {
            let allCompleted = true;
            
            // Required fields
            const requiredFields = [
                'contractor-name',
                'contractor-email',
                'contractor-phone',
                'contractor-address',
                'country-residence',
                'primary-subjects',
                'education-level'
            ];
            
            // Check required fields
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field) return;
                
                if (field.type === 'select-one' || field.type === 'select') {
                    if (!field.value) {
                        allCompleted = false;
                    }
                } else if (!field.value.trim()) {
                    allCompleted = false;
                }
            });
            
            // Check checkboxes
            const ageCheck = document.getElementById('age-verification');
            const privacyCheck = document.getElementById('privacy-consent');
            const finalAgreement = document.getElementById('final-agreement');
            
            if (!ageCheck || !ageCheck.checked) {
                allCompleted = false;
            }
            
            if (!privacyCheck || !privacyCheck.checked) {
                allCompleted = false;
            }
            
            if (!finalAgreement || !finalAgreement.checked) {
                allCompleted = false;
            }
            
            // Check contractor signature
            const contractorSigned = document.getElementById('contractor-signature').classList.contains('signed');
            
            if (!contractorSigned) {
                allCompleted = false;
            }
            
            // Update completion button
            const completeButton = document.getElementById('complete-contract-button');
            if (allCompleted) {
                completeButton.disabled = false;
                completeButton.style.opacity = '1';
                completeButton.style.cursor = 'pointer';
            } else {
                completeButton.disabled = true;
                completeButton.style.opacity = '0.7';
                completeButton.style.cursor = 'not-allowed';
            }
            
            return allCompleted;
        }
        
        // ============================================
        // FINAL SUBMISSION FUNCTIONS
        // ============================================
        
        // Collect all form data
        function collectFormData() {
            const paymentMethod = document.querySelector('.payment-option-btn.active').dataset.payment;
            
            const data = {
                contractorName: document.getElementById('contractor-name').value.trim(),
                contractorEmail: document.getElementById('contractor-email').value.trim(),
                contractorPhone: document.getElementById('contractor-phone').value.trim(),
                contractorAddress: document.getElementById('contractor-address').value.trim(),
                countryResidence: document.getElementById('country-residence').value,
                emergencyContact: document.getElementById('emergency-contact').value.trim(),
                contractorTaxId: document.getElementById('contractor-tax-id').value.trim(),
                primarySubjects: document.getElementById('primary-subjects').value.trim(),
                educationLevel: document.getElementById('education-level').value,
                ageVerification: document.getElementById('age-verification').checked,
                paymentMethod: paymentMethod,
                signatureDate: signatureDate,
                privacyConsent: document.getElementById('privacy-consent').checked,
                finalAgreement: document.getElementById('final-agreement').checked
            };
            
            // Add payment-specific data
            if (paymentMethod === 'canadian') {
                data.bankName = document.getElementById('bank-name').value;
                data.accountHolder = document.getElementById('account-holder').value.trim();
                data.institutionNumber = document.getElementById('institution-number').value.trim();
                data.transitNumber = document.getElementById('transit-number').value.trim();
                data.accountNumber = document.getElementById('account-number').value.trim();
                data.accountType = document.getElementById('account-type').value;
                data.fullBankNumber = document.getElementById('full-bank-number').value;
            } else if (paymentMethod === 'paypal') {
                data.paypalEmail = document.getElementById('paypal-email').value.trim();
                data.paypalCurrency = document.getElementById('paypal-currency').value;
                data.paypalFeeAcknowledgment = document.getElementById('paypal-fee-acknowledgment').checked;
            }
            
            return data;
        }
        
        // Show final submission steps
        document.getElementById('complete-contract-button').addEventListener('click', async function() {
            if (!checkFormCompletion()) {
                alert('Please complete all required fields, check all boxes, and sign as the contractor.');
                return;
            }
            
            // Show loading state
            const button = this;
            const originalText = button.innerHTML;
            button.innerHTML = '‚è≥ Processing...';
            button.disabled = true;
            
            // Show loading message
            document.getElementById('status-message').innerHTML = `
                <div class="status-loading" style="display: block;">
                    <strong>Processing...</strong> Saving your contract to our secure database.
                </div>
            `;
            document.getElementById('status-message').style.display = 'block';
            
            try {
                // Generate Contract ID
                contractId = generateContractId();
                document.getElementById('contract-id-display').textContent = contractId;
                document.getElementById('final-contract-id').textContent = contractId;
                document.getElementById('submission-date').textContent = new Date().toLocaleString();
                
                // Collect form data
                const formData = collectFormData();
                formData.contractId = contractId;
                
                // Save ALL data to contracts collection in Firestore
                const documentId = await saveAllDataToFirestore(formData);
                
                // Show final steps
                document.getElementById('final-step-section').style.display = 'block';
                
                // Update email template with actual data
                updateEmailTemplate();
                
                // Show success message
                document.getElementById('status-message').innerHTML = `
                    <div class="status-success" style="display: block; text-align: left;">
                        <strong style="font-size: 1.1em;">üéâ Congratulations! Your tutor contract has been submitted.</strong><br><br>
                        <strong>Your contract reference number:</strong> ${contractId}<br><br>
                        <strong>Next steps:</strong><br>
                        1. Save/print your contract<br>
                        2. Email it to us<br>
                        3. We'll review and activate your account within 48 hours
                    </div>
                `;
                document.getElementById('status-message').style.display = 'block';
                
                // Scroll to final steps
                document.getElementById('final-step-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });
                
                // Hide completion button
                button.style.display = 'none';
                
            } catch (error) {
                console.error("Error during contract submission:", error);
                
                // Show error message
                document.getElementById('status-message').innerHTML = `
                    <div class="status-error" style="display: block;">
                        <strong>‚ùå Error:</strong> Failed to save contract data. Please try again or contact support.<br>
                        ${error.message || 'Unknown error occurred'}
                    </div>
                `;
                document.getElementById('status-message').style.display = 'block';
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });
        
        // Update email template with actual data
        function updateEmailTemplate() {
            const name = document.getElementById('contractor-name').value;
            const email = document.getElementById('contractor-email').value;
            const phone = document.getElementById('contractor-phone').value;
            
            const template = `Subject: Tklesson Tutor Contract Submission - ${name}

Dear Tklesson Team,

Please find attached my completed and signed Tutor Independent Contractor Agreement.

Contract Details:
- Name: ${name}
- Email: ${email}
- Phone: ${phone}
- Contract ID: ${contractId}
- Date Signed: ${signatureDate}
- Signing Order: Second Signatory (Accepted Tklesson's offer)

I have reviewed and agreed to all terms and conditions outlined in the contract.

Please confirm receipt and next steps.

Sincerely,

${name}`;
            
            document.getElementById('email-template').textContent = template;
        }
        
        // Copy email template to clipboard
        function copyEmailTemplate() {
            const template = document.getElementById('email-template').textContent;
            navigator.clipboard.writeText(template)
                .then(() => {
                    alert('Email template copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        }
        
        // Open email client with pre-filled template
        function openEmailWithTemplate() {
            if (!contractId) {
                alert('Please complete the contract first.');
                return;
            }
            
            const name = document.getElementById('contractor-name').value;
            const email = document.getElementById('contractor-email').value;
            
            const subject = `Tklesson Tutor Contract Submission - ${name}`;
            const body = `Dear Tklesson Team,

Please find attached my completed and signed Tutor Independent Contractor Agreement.

Contract Details:
- Name: ${name}
- Email: ${email}
- Contract ID: ${contractId}
- Date Signed: ${signatureDate}
- Signing Order: Second Signatory (Accepted Tklesson's offer)

I have reviewed and agreed to all terms and conditions outlined in the contract.

Please confirm receipt and next steps.

Sincerely,

${name}`;
            
            window.location.href = `mailto:info@tklesson.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        
        // Add event listeners for dynamic validation
        function setupEventListeners() {
            // Listen to all inputs for validation
            document.querySelectorAll('.form-input, select').forEach(field => {
                field.addEventListener('input', checkFormCompletion);
                field.addEventListener('change', checkFormCompletion);
            });
            
            // Listen to checkboxes
            document.getElementById('age-verification').addEventListener('change', checkFormCompletion);
            document.getElementById('privacy-consent').addEventListener('change', checkFormCompletion);
            document.getElementById('final-agreement').addEventListener('change', checkFormCompletion);
            document.getElementById('paypal-fee-acknowledgment').addEventListener('change', checkFormCompletion);
            
            // Listen to country change
            document.getElementById('country-residence').addEventListener('change', function() {
                updatePaymentOptions();
                checkFormCompletion();
            });
            
            // Bank number auto-update
            if (document.getElementById('institution-number')) {
                document.getElementById('institution-number').addEventListener('input', updateBankNumber);
                document.getElementById('transit-number').addEventListener('input', updateBankNumber);
                document.getElementById('account-number').addEventListener('input', updateBankNumber);
            }
            
            // Auto-fill institution number based on bank selection
            if (document.getElementById('bank-name')) {
                document.getElementById('bank-name').addEventListener('change', function() {
                    const bankCodes = {
                        'td': '004',
                        'rbc': '003',
                        'scotiabank': '002',
                        'bmo': '001',
                        'cibc': '010',
                        'hsbc': '016',
                        'national': '006',
                        'tangerine': '614'
                    };
                    
                    const selectedBank = this.value;
                    if (bankCodes[selectedBank]) {
                        document.getElementById('institution-number').value = bankCodes[selectedBank];
                        updateBankNumber();
                    } else if (selectedBank === 'other') {
                        document.getElementById('institution-number').value = '';
                        document.getElementById('institution-number').focus();
                    }
                });
            }
        }
        
        // ============================================
        // INITIALIZE EVERYTHING
        // ============================================
        
        function init() {
            // Initialize Firebase services
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            
            // Initialize signatures
            initializeCompanySignature();
            
            // Setup payment and event listeners
            setupPaymentToggle();
            setupEventListeners();
            updatePaymentOptions();
            checkFormCompletion();
            
            // Initial Contract ID generation
            contractId = generateContractId();
        }
        
        // Run initialization when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
