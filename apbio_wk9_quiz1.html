<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP Biology Quiz – Tklesson</title>

<link rel="canonical" href="https://tklesson.com/" />
<link rel="icon" type="image/png" sizes="16x16" href="/Tklesson1-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/Tklesson1-32x32.png">
<link rel="icon" type="image/png" sizes="48x48" href="/Tklesson1-48x48.png">
<link rel="icon" type="image/png" sizes="64x64" href="/Tklesson1-64x64.png">
<link rel="icon" type="image/png" sizes="192x192" href="/Tklesson1-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/Tklesson1-512x512.png">
<link rel="apple-touch-icon" href="/Tklesson1-192x192.png">
<meta name="theme-color" content="#0f4c81">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-99H54WVS80"></script>
<script>
  window.addEventListener('load', function() {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-99H54WVS80');
  });
</script>

<!-- Add Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<style>
/* Your existing CSS remains exactly the same */
:root {
  --primary: #0f4c81;
  --primary-light: #1a5d9f;
  --primary-dark: #0a3a66;
  --secondary: #ff9e1b;
  --secondary-light: #ffb04d;
  --secondary-dark: #e58a0c;
  --accent: #e6375a;
  --light: #f8fafc;
  --dark: #1e293b;
  --gray: #94a3b8;
  --success: #27ae60;
  --error: #e74c3c;
  --warning: #f39c12;
  --text: #2d3748;
  --text-light: #718096;
  --border: #e2e8f0;
  --card-bg: #ffffff;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

body {
  font-family: 'Poppins', sans-serif;
  line-height: 1.6;
  color: var(--text);
  background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
  min-height: 100vh;
  overflow-x: hidden;
}

.selectable {
  -webkit-user-select: text;
  -khtml-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

a {
  text-decoration: none;
  color: inherit;
  transition: all 0.3s ease;
}

img {
  max-width: 100%;
}

.container {
  width: 100%;
  max-width: 1000px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

/* Header */
.quiz-header {
  background: var(--gradient);
  color: white;
  padding: 1.5rem 2rem;
  text-align: center;
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.quiz-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
  opacity: 0.5;
}

.header-content {
  position: relative;
  z-index: 1;
}

.header-logo {
  height: 60px;
  margin-bottom: 0.5rem;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.header-title {
  font-family: 'Roboto Slab', serif;
  font-size: 2.2rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.header-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  color: #e2e8f0;
  font-weight: 400;
}

/* Quiz Container */
.quiz-container {
  background: white;
  border-radius: 1rem;
  margin: 2rem auto;
  padding: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.quiz-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--gradient-secondary);
}

.user-info {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

@media (max-width: 768px) {
  .user-info {
    grid-template-columns: 1fr;
  }
}

.input-group {
  display: flex;
  flex-direction: column;
  position: relative;
}

.input-group label {
  font-weight: 500;
  margin-bottom: 0.5rem;
  color: var(--dark);
  display: flex;
  align-items: center;
}

.input-group label::after {
  content: '*';
  color: var(--accent);
  margin-left: 0.25rem;
}

.input-group input {
  padding: 0.75rem 1rem;
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
}

.input-group input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(15, 76, 129, 0.1);
}

/* Timer */
.timer-container {
  background: var(--dark);
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: 2rem;
  display: inline-flex;
  align-items: center;
  margin-bottom: 1.5rem;
  font-weight: 600;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden;
}

.timer-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, var(--primary-dark), var(--primary));
  opacity: 0.9;
  z-index: 0;
}

.timer-icon {
  margin-right: 0.5rem;
  font-size: 1.2rem;
  position: relative;
  z-index: 1;
}

.timer-value {
  font-size: 1.3rem;
  font-variant-numeric: tabular-nums;
  position: relative;
  z-index: 1;
  font-weight: 700;
}

.timer-warning {
  color: var(--warning);
}

.timer-danger {
  color: var(--error);
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}

/* Questions */
.questions-container {
  margin-bottom: 2rem;
}

.question-card {
  background: #f8fafc;
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  border-left: 4px solid var(--primary);
  transition: all 0.3s ease;
  position: relative;
}

.question-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.question-number {
  position: absolute;
  top: -12px;
  left: 15px;
  background: var(--primary);
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.9rem;
  box-shadow: var(--shadow);
}

.question-text {
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--dark);
  font-size: 1.1rem;
  padding-top: 0.5rem;
}

.answer-input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  font-size: 1rem;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  background: white;
  -webkit-user-select: text;
  -khtml-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

.answer-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(15, 76, 129, 0.1);
}

.answer-input.correct {
  border-color: var(--success);
  background-color: rgba(39, 174, 96, 0.05);
}

.answer-input.incorrect {
  border-color: var(--error);
  background-color: rgba(231, 76, 60, 0.05);
}

/* Buttons */
.buttons-container {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  outline: none;
  font-size: 1rem;
  font-family: 'Poppins', sans-serif;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-secondary {
  background: var(--secondary);
  color: white;
}

.btn-secondary:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  background: #219653;
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

/* Results */
.results-container {
  margin-top: 2rem;
  padding: 1.5rem;
  border-radius: 0.75rem;
  background: #f1f5f9;
  display: none;
  border-left: 4px solid var(--primary);
}

.score-display {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  text-align: center;
  color: var(--dark);
}

.correct-answer {
  color: var(--success);
  font-weight: 600;
  margin-top: 0.5rem;
  font-size: 0.95rem;
}

/* Message */
.message {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-top: 1rem;
  font-weight: 500;
  text-align: center;
  display: none;
}

.message-error {
  background: #fee2e2;
  color: var(--error);
  border: 1px solid #fecaca;
}

.message-success {
  background: #d1fae5;
  color: var(--success);
  border: 1px solid #a7f3d0;
}

/* Animation */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.5s ease forwards;
}

/* Progress bar */
.progress-container {
  width: 100%;
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  margin-bottom: 1.5rem;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  background: var(--gradient-secondary);
  border-radius: 3px;
  width: 0%;
  transition: width 0.5s ease;
}

/* Responsive */
@media (max-width: 768px) {
  .quiz-header {
    padding: 1rem;
  }
  
  .header-title {
    font-size: 1.8rem;
  }
  
  .header-subtitle {
    font-size: 1rem;
  }
  
  .quiz-container {
    padding: 1.5rem;
    margin: 1rem;
  }
  
  .buttons-container {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}

/* MathJax styling */
.MathJax {
  font-size: 1.1rem !important;
}

.mjx-chtml {
  outline: none;
}

/* Copy protection warning */
.copy-warning {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: var(--error);
  color: white;
  text-align: center;
  padding: 10px;
  font-weight: 500;
  z-index: 1000;
  display: none;
}
</style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>

<div class="copy-warning" id="copyWarning">Copy-paste is disabled for this quiz.</div>

<header class="quiz-header">
    <div class="header-content">
        <img src="Tklesson1.png" alt="Tklesson Logo" class="header-logo">
        <h1 class="header-title">AP Biology Quiz – Tklesson</h1>
        <p class="header-subtitle">Mid-Term Review (Quiz 1)</p>
    </div>
</header>

<div class="container">
    <div class="quiz-container">
        <div id="startScreen" style="text-align: center; padding: 2rem;">
            <p style="font-size: 1.2rem; margin-bottom: 1.5rem;">Ready to begin? This is a 60-minute quiz on AP Biology.</p>
            <button id="startBtn" class="btn btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;">Start Quiz</button>
        </div>

        <div id="quizContent" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="user-info">
                <div class="input-group">
                    <label for="name">Your Name</label>
                    <input type="text" id="name" placeholder="Enter your name" required>
                </div>
                <div class="input-group">
                    <label for="email">Your Email</label>
                    <input type="email" id="email" placeholder="you@example.com" required>
                </div>
            </div>

            <div class="timer-container">
                <span class="timer-icon">⏱️</span>
                <span class="timer-value" id="timer">60:00</span>
            </div>

            <div id="questions-container" class="questions-container"></div>

            <div class="buttons-container">
                <button id="submitBtn" class="btn btn-primary">Submit Answers</button>
                <button id="restartBtn" class="btn btn-secondary">Restart Quiz</button>
                <button id="solution-btn" class="btn btn-success">View Solution Pack</button>
            </div>

            <div id="results-container" class="results-container"></div>
            <div id="message" class="message"></div>
        </div>
    </div>
</div>

<script>
// Initialize Firebase with your configuration
const firebaseConfig = {
  apiKey: "AIzaSyDq9F28x6D4ivUJoT3ycHRlU_c-YNctFtE",
  authDomain: "email-notifications-1c77b.firebaseapp.com",
  projectId: "email-notifications-1c77b",
  storageBucket: "email-notifications-1c77b.firebasestorage.app",
  messagingSenderId: "272046681025",
  appId: "1:272046681025:web:e0aff95e41caa65c6d1d40",
  measurementId: "G-B3VJ7R5R8H"
};


// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const questions = [
    // ========================
    // Unit 1: Chemistry of Life / Macromolecules (10 questions)
    // ========================
    {
        type: 'mcq',
        q: "Which macromolecule is primarily used for long-term energy storage in animals?",
        options: [
            "Carbohydrates",
            "Lipids", 
            "Proteins",
            "Nucleic acids"
        ],
        answer: "B"
    },
    {
        type: 'mcq',
        q: "During hydrolysis, a polymer is broken down into its monomers by:",
        options: [
            "Adding water",
            "Removing water",
            "Heating",
            "Using ATP"
        ],
        answer: "A"
    },
    {
        type: 'mcq',
        q: "Which macromolecule contains amino acids as its monomers?",
        options: [
            "Nucleic acids",
            "Carbohydrates", 
            "Proteins",
            "Lipids"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Enzymes are mainly made of which macromolecule?",
        options: [
            "Carbohydrates",
            "Lipids",
            "Nucleic acids",
            "Proteins"
        ],
        answer: "D"
    },
    {
        type: 'mcq',
        q: "Which bond holds amino acids together in a protein?",
        options: [
            "Peptide bond",
            "Glycosidic bond",
            "Hydrogen bond",
            "Phosphodiester bond"
        ],
        answer: "A"
    },
    {
        type: 'mcq',
        q: "Which macromolecule forms the cell membrane?",
        options: [
            "Proteins",
            "Carbohydrates",
            "Lipids",
            "Nucleic acids"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which carbohydrate is a structural polysaccharide in plant cell walls?",
        options: [
            "Starch",
            "Glycogen",
            "Chitin",
            "Cellulose"
        ],
        answer: "D"
    },
    {
        type: 'mcq',
        q: "Which nucleic acid stores genetic information?",
        options: [
            "RNA",
            "ATP",
            "DNA",
            "NADH"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "What type of reaction links monomers into polymers?",
        options: [
            "Hydrolysis",
            "Dehydration synthesis",
            "Combustion",
            "Oxidation"
        ],
        answer: "B"
    },
    {
        type: 'mcq',
        q: "Lipids are mostly:",
        options: [
            "Hydrophilic",
            "Polar",
            "Hydrophobic",
            "Ionic"
        ],
        answer: "C"
    },

    // ========================
    // Unit 2: Cell Structure & Function (10 questions)
    // ========================
    {
        type: 'mcq',
        q: "The site of protein synthesis in a cell is:",
        options: [
            "Nucleus",
            "Golgi apparatus",
            "Lysosome",
            "Ribosome"
        ],
        answer: "D"
    },
    {
        type: 'mcq',
        q: "Which organelle contains digestive enzymes?",
        options: [
            "Lysosome",
            "Mitochondria",
            "Chloroplast",
            "Endoplasmic reticulum"
        ],
        answer: "A"
    },
    {
        type: 'mcq',
        q: "The plasma membrane is composed mainly of:",
        options: [
            "Proteins only",
            "Carbohydrates only",
            "Phospholipids",
            "Nucleic acids"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which organelle is the site of ATP production?",
        options: [
            "Nucleus",
            "Golgi apparatus",
            "Mitochondria",
            "Ribosome"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Prokaryotic cells lack:",
        options: [
            "Ribosomes",
            "Cytoplasm",
            "Nucleus",
            "Cell membrane"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which structure helps maintain cell shape and provides support?",
        options: [
            "Cytoskeleton",
            "Endoplasmic reticulum",
            "Lysosome",
            "Golgi apparatus"
        ],
        answer: "A"
    },
    {
        type: 'mcq',
        q: "Which organelle modifies, sorts, and packages proteins?",
        options: [
            "Ribosome",
            "Golgi apparatus",
            "Mitochondria",
            "Nucleus"
        ],
        answer: "B"
    },
    {
        type: 'mcq',
        q: "What is the function of the rough ER?",
        options: [
            "Lipid synthesis",
            "DNA storage",
            "Protein synthesis and modification",
            "Photosynthesis"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which structure regulates what enters and exits the cell?",
        options: [
            "Nucleus",
            "Ribosome",
            "Plasma membrane",
            "Lysosome"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Plant cells have all of the following except:",
        options: [
            "Cell wall",
            "Chloroplast",
            "Large central vacuole",
            "Centrioles"
        ],
        answer: "D"
    },

    // ========================
    // Unit 3: Cellular Energetics / Enzymes & Metabolism (10 questions)
    // ========================
    {
        type: 'mcq',
        q: "Enzymes function by:",
        options: [
            "Providing energy for reactions",
            "Changing the products of reactions",
            "Lowering the activation energy of reactions",
            "Being consumed in reactions"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which molecule is the main energy currency of the cell?",
        options: [
            "ADP",
            "ATP",
            "NADH",
            "Glucose"
        ],
        answer: "B"
    },
    {
        type: 'mcq',
        q: "Photosynthesis takes place in:",
        options: [
            "Mitochondria",
            "Nucleus",
            "Chloroplasts",
            "Cytoplasm"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "The first step of cellular respiration is:",
        options: [
            "Krebs cycle",
            "Electron transport chain",
            "Glycolysis",
            "Fermentation"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which process occurs without oxygen?",
        options: [
            "Aerobic respiration",
            "Photosynthesis",
            "Anaerobic respiration / fermentation",
            "Oxidative phosphorylation"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Enzymes are specific because of their:",
        options: [
            "Substrate",
            "Product",
            "Active site",
            "Cofactor"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "In cellular respiration, glucose is ultimately converted to:",
        options: [
            "Protein",
            "DNA",
            "ATP, CO₂, and H₂O",
            "Lipid"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Competitive inhibitors bind to the:",
        options: [
            "Substrate",
            "Product",
            "Active site of the enzyme",
            "Allosteric site"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "What happens to an enzyme if it is denatured?",
        options: [
            "It speeds up reactions",
            "It binds more substrate",
            "It loses its shape and function",
            "It becomes more stable"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which stage of cellular respiration produces the most ATP?",
        options: [
            "Glycolysis",
            "Krebs cycle",
            "Fermentation",
            "Electron transport chain"
        ],
        answer: "D"
    },

    // ========================
    // Unit 4: Cell Communication & Cell Cycle (10 questions)
    // ========================
    {
        type: 'mcq',
        q: "Which stage of the cell cycle is DNA replicated?",
        options: [
            "G1 phase",
            "G2 phase",
            "S phase",
            "M phase"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Mitosis produces:",
        options: [
            "Four gametes",
            "One diploid cell",
            "Two identical daughter cells",
            "Two gametes"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which phase of mitosis is characterized by chromosomes lining up in the center?",
        options: [
            "Prophase",
            "Anaphase",
            "Metaphase",
            "Telophase"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Cyclins are important because they:",
        options: [
            "Produce energy",
            "Aid in DNA replication",
            "Regulate the cell cycle",
            "Form the mitotic spindle"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which of the following is a form of cell signaling?",
        options: [
            "Ribosomes",
            "Lysosomes",
            "Hormones",
            "ATP"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "During apoptosis, a cell:",
        options: [
            "Divides rapidly",
            "Produces ATP",
            "Undergoes programmed cell death",
            "Synthesizes DNA"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Which phase immediately follows mitosis?",
        options: [
            "S phase",
            "G1 phase",
            "Cytokinesis",
            "G2 phase"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Receptors on the cell membrane bind to:",
        options: [
            "DNA",
            "ATP",
            "Signaling molecules / ligands",
            "Ribosomes"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "A tumor suppressor gene normally:",
        options: [
            "Promotes cell division",
            "Encodes enzymes for digestion",
            "Prevents uncontrolled cell division",
            "Makes ribosomes"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Gap 1 (G1) phase involves:",
        options: [
            "DNA replication",
            "Chromosome separation",
            "Cell growth and normal functions",
            "Cytokinesis"
        ],
        answer: "C"
    },

    // ========================
    // Unit 5: Genetics / Heredity (10 questions)
    // ========================
    {
        type: 'mcq',
        q: "The basic unit of heredity is the:",
        options: [
            "Chromosome",
            "Allele",
            "Gene",
            "Nucleotide"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Alleles are different forms of:",
        options: [
            "Different genes",
            "Chromosomes",
            "The same gene",
            "Proteins"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Homozygous means:",
        options: [
            "Two different alleles",
            "One allele only",
            "Two identical alleles",
            "No alleles"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Heterozygous means:",
        options: [
            "Two identical alleles",
            "One allele only",
            "Two different alleles",
            "No alleles"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "The physical expression of a gene is its:",
        options: [
            "Genotype",
            "Allele",
            "Phenotype",
            "Chromosome"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "The combination of alleles in an organism is its:",
        options: [
            "Phenotype",
            "Protein",
            "Genotype",
            "Chromosome"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "During meiosis, the chromosome number is:",
        options: [
            "Doubled",
            "Tripled",
            "Reduced by half",
            "Remains the same"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Dominant alleles:",
        options: [
            "Are always more frequent",
            "Are never expressed",
            "Mask recessive alleles in heterozygotes",
            "Only exist in homozygotes"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "Recessive alleles:",
        options: [
            "Always dominant",
            "Encode enzymes",
            "Are only expressed when homozygous",
            "Are lethal"
        ],
        answer: "C"
    },
    {
        type: 'mcq',
        q: "During fertilization, offspring receive:",
        options: [
            "All alleles from the mother",
            "All alleles from the father",
            "One allele from each parent per gene",
            "Two alleles from each parent"
        ],
        answer: "C"
    }
];

// DOM elements
const questionsContainer = document.getElementById('questions-container');
const timerEl = document.getElementById('timer');
const submitBtn = document.getElementById('submitBtn');
const restartBtn = document.getElementById('restartBtn');
const solutionBtn = document.getElementById('solution-btn');
const resultsContainer = document.getElementById('results-container');
const messageEl = document.getElementById('message');
const progressBar = document.getElementById('progressBar');
const copyWarning = document.getElementById('copyWarning');
const startBtn = document.getElementById('startBtn');
const startScreen = document.getElementById('startScreen');
const quizContent = document.getElementById('quizContent');

// Quiz state
let remainingTime = 60 * 60;
let timerId;
let quizSubmitted = false;

// Copy-paste protection
document.addEventListener('copy', function(e) {
    if (!e.target.classList.contains('selectable')) {
        e.preventDefault();
        showCopyWarning();
    }
});

document.addEventListener('paste', function(e) {
    if (!e.target.classList.contains('selectable')) {
        e.preventDefault();
        showCopyWarning();
    }
});

document.addEventListener('cut', function(e) {
    if (!e.target.classList.contains('selectable')) {
        e.preventDefault();
        showCopyWarning();
    }
});

// Right-click disable
document.addEventListener('contextmenu', function(e) {
    if (!e.target.classList.contains('selectable')) {
        e.preventDefault();
        showCopyWarning();
    }
});

function showCopyWarning() {
    copyWarning.style.display = 'block';
    setTimeout(() => {
        copyWarning.style.display = 'none';
    }, 3000);
}

// Shuffle helper
function shuffleArray(arr) { 
    return arr.sort(() => Math.random() - 0.5); 
}

// Initialize quiz without starting timer
function initQuiz() {
    shuffleArray(questions);
    renderQuiz();
    quizSubmitted = false;
    solutionBtn.style.display = 'none';
    resultsContainer.style.display = 'none';
    messageEl.style.display = 'none';
    
    // Enable inputs
    const inputs = document.querySelectorAll('.answer-input');
    inputs.forEach(input => {
        input.disabled = false;
        input.classList.remove('correct', 'incorrect');
        const parent = input.parentNode;
        const correctAnswerEl = parent.querySelector('.correct-answer');
        if(correctAnswerEl) parent.removeChild(correctAnswerEl);
    });
    
    // Reset progress bar
    progressBar.style.width = '0%';
}

// Render questions
function renderQuiz() {
    questionsContainer.innerHTML = '';
    
    questions.forEach((question, index) => {
        const questionEl = document.createElement('div');
        questionEl.className = 'question-card animate-fadeIn';
        questionEl.style.animationDelay = `${index * 0.05}s`;
        
        let questionHTML = `
            <div class="question-number">${index + 1}</div>
            <div class="question-text">${question.q}</div>
        `;
        
        if (question.type === 'mcq' && question.options) {
            // Display multiple choice options
            question.options.forEach((option, optIndex) => {
                questionHTML += `
                    <div class="option">
                        <input type="radio" id="q${index}_opt${optIndex}" name="q${index}" value="${String.fromCharCode(65 + optIndex)}">
                        <label for="q${index}_opt${optIndex}">${option}</label>
                    </div>
                `;
            });
        } else {
            // Fallback to text input for non-MCQ questions
            questionHTML += `<input type="text" class="answer-input selectable" id="q${index}" placeholder="Enter your answer" data-index="${index}">`;
        }
        
        questionEl.innerHTML = questionHTML;
        questionsContainer.appendChild(questionEl);
    });
    
    // Re-render MathJax
    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        MathJax.typesetPromise();
    }
}

// Start timer
function startTimer() {
    clearInterval(timerId);
    remainingTime = 60 * 60;
    updateTimerDisplay();
    
    timerId = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();
        updateProgressBar();
        
        if (remainingTime <= 0) {
            clearInterval(timerId);
            handleTimeUp();
        }
    }, 1000);
}

// Update timer display
function updateTimerDisplay() {
    const minutes = Math.floor(remainingTime / 60);
    const seconds = remainingTime % 60;
    timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Change color when time is running out
    if (remainingTime < 300) { // 5 minutes
        timerEl.className = 'timer-value timer-danger';
    } else if (remainingTime < 600) { // 10 minutes
        timerEl.className = 'timer-value timer-warning';
    } else {
        timerEl.className = 'timer-value';
    }
}

// Update progress bar
function updateProgressBar() {
    const totalTime = 60 * 60;
    const progress = ((totalTime - remainingTime) / totalTime) * 100;
    progressBar.style.width = `${progress}%`;
}

// Handle time up
function handleTimeUp() {
    disableInputs();
    showMessage('Time is up! Quiz is now disabled.', 'error');
    
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    
    if (name && email) {
        checkAnswers();
    }
}

// Disable inputs
function disableInputs() {
    const inputs = document.querySelectorAll('.answer-input');
    inputs.forEach(input => {
        input.disabled = true;
        input.style.backgroundColor = '#f1f5f9';
    });
}

// Check answers
async function checkAnswers() {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    
    // Validate inputs
    if (!name) {
        showMessage('Please enter your name.', 'error');
        document.getElementById('name').focus();
        return;
    }
    
    if (!email) {
        showMessage('Please enter your email.', 'error');
        document.getElementById('email').focus();
        return;
    }
    
    let score = 0;
    const submissionData = [];
    
    // Check each question and show results IN the quiz
    for (let index = 0; index < questions.length; index++) {
        const question = questions[index];
        let userAnswer = '';
        let isCorrect = false;
        
        if (question.type === 'mcq' && question.options) {
            // Get the selected radio button for this question
            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
            userAnswer = selectedOption ? selectedOption.value : 'Not answered';
            isCorrect = userAnswer === question.answer;
            
            // Disable all radio buttons for this question
            const allOptions = document.querySelectorAll(`input[name="q${index}"]`);
            allOptions.forEach(opt => opt.disabled = true);
            
            // Highlight the correct answer in GREEN
            // Highlight the correct answer in GREEN
const correctOption = document.querySelector(`input[name="q${index}"][value="${question.answer}"]`);
if (correctOption && correctOption.nextElementSibling) {
    const correctLabel = correctOption.nextElementSibling;
    correctLabel.style.color = 'var(--success)';
    correctLabel.style.fontWeight = 'bold';
}

// Highlight user's answer if incorrect in RED
if (selectedOption && !isCorrect) {
    const userLabel = selectedOption.nextElementSibling;
    userLabel.style.color = 'var(--error)';
    userLabel.style.fontWeight = 'bold';
}
        }
        
        if (isCorrect) {
            score++;
        }
        
        submissionData.push({
            question: question.q,
            correctAnswer: question.answer,
            studentAnswer: userAnswer || 'Not answered'
        });
    }
    
    // Display results
    showResults(score);
    
    // Show solution button
    solutionBtn.style.display = 'inline-block';
    quizSubmitted = true;
    
    // Stop timer
    clearInterval(timerId);
    
    // Save to Firestore and trigger email
    try {
        // Save quiz results to Firestore
        const quizResult = {
            name: name,
            email: email,
            score: `${score}/${questions.length}`,
            questions: submissionData,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            quizName: "AP Biology Mid-Term Review (Quiz 1)"
        };
        
        // Add to Firestore - this will trigger the Cloud Function
        await db.collection('quizResults').add(quizResult);
        
        showMessage('Quiz submitted successfully! Results have been emailed to you.', 'success');
    } catch (err) {
        console.error('Error saving quiz results:', err);
        showMessage('Quiz submitted locally, but there was an issue sending the email.', 'warning');
    }
}

// Show results
function showResults(score) {
    resultsContainer.style.display = 'block';
    resultsContainer.innerHTML = `
        <div class="score-display">Your score: ${score} / ${questions.length}</div>
        <div>${getScoreMessage(score, questions.length)}</div>
    `;
}

// Get score message
function getScoreMessage(score, total) {
    const percentage = (score / total) * 100;
    
    if (percentage >= 90) return 'Excellent work! You have a strong understanding of AP Biology concepts.';
    if (percentage >= 70) return 'Good job! You understand most concepts but could use some review.';
    if (percentage >= 50) return 'Not bad! Review the concepts you missed and try again.';
    return 'Keep practicing! Review the solution pack and try again.';
}

// Show message
function showMessage(text, type) {
    messageEl.textContent = text;
    messageEl.className = `message message-${type}`;
    messageEl.style.display = 'block';
}

// Show solution
function showSolution() {
    window.open('apbio_wk7_quiz9_explanation.html', '_blank');
}

// Event listeners
submitBtn.addEventListener('click', checkAnswers);

restartBtn.addEventListener('click', () => {
    if (quizSubmitted) {
        // If quiz was already submitted, reset everything including timer
        initQuiz();
        startTimer();
    } else {
        // If quiz is in progress, just reshuffle questions but keep timer running
        shuffleArray(questions);
        renderQuiz();
    }
    showMessage('Quiz restarted. Good luck!', 'success');
});

solutionBtn.addEventListener('click', showSolution);

startBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    quizContent.style.display = 'block';
    initQuiz();
    startTimer();
});

// Initial setup on page load
document.addEventListener('DOMContentLoaded', () => {
    // Hide quiz content initially, show start screen
    quizContent.style.display = 'none';
    startScreen.style.display = 'block';
    
    // Pre-render questions on page load so MathJax is ready
    renderQuiz();
});
</script>

</body>
</html>
