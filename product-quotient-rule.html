<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AP Calculus Quiz – Tklesson</title>

<link rel="canonical" href="https://tklesson.com/" />
<link rel="icon" type="image/png" sizes="16x16" href="/Tklesson1-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/Tklesson1-32x32.png">
<link rel="icon" type="image/png" sizes="48x48" href="/Tklesson1-48x48.png">
<link rel="icon" type="image/png" sizes="64x64" href="/Tklesson1-64x64.png">
<link rel="icon" type="image/png" sizes="192x192" href="/Tklesson1-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/Tklesson1-512x512.png">
<link rel="apple-touch-icon" href="/Tklesson1-192x192.png">

<meta name="theme-color" content="#ffffff">

<!-- MathJax for LaTeX -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    }
  };
</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-99H54WVS80"></script>
<script>
  window.addEventListener('load', function() {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-99H54WVS80');
  });
</script>

<style>
body { font-family: 'Arial', sans-serif; background: #f0f8ff; margin:0; padding:0; }
header { background: #01579b; color: white; padding: 15px; text-align: center; }
header img { max-height: 60px; vertical-align: middle; margin-right: 10px; }
h1 { display: inline; font-size: 2em; }
h2 { font-size: 1.2em; font-weight: normal; color: #e1f5fe; margin-top: 5px; }
.quiz-container { max-width: 900px; margin: 30px auto; padding: 25px; background: white; border-radius: 12px; box-shadow: 0 0 15px #555; }
.question { margin-bottom: 20px; padding: 15px; border-radius: 8px; background: #e1f5fe; border-left: 4px solid #0288d1; }
.question p { font-weight: bold; margin-bottom: 10px; }
.math-display { font-size: 1.1em; margin: 10px 0; padding: 5px; background: #f8fdff; border-radius: 4px; }
.options label { display: block; margin-bottom: 8px; padding: 8px; border-radius: 4px; }
.options label:hover { background: #bbdefb; }
input[type="text"], input[type="email"] { width: 100%; padding: 6px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
button { background-color: #0288d1; color: white; padding: 10px 25px; border: none; cursor: pointer; font-size: 1em; border-radius: 5px; margin-top: 10px; margin-right: 10px; }
button:hover { background-color: #01579b; }

.correct { background-color: #c8e6c9; border-left-color: #4caf50; }
.wrong { background-color: #ffcdd2; border-left-color: #f44336; }
#score { font-size: 1.3em; font-weight: bold; margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px; }
.email-container { margin-bottom: 15px; }
#submission-message { margin-top: 10px; font-weight: bold; color: #01579b; }
.mathjax-container { overflow-x: auto; }
.formula-box { background: #f1f8e9; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #c5e1a5; }
</style>
</head>
<body>

<header>
    <img src="Tklesson1.png" alt="Tklesson Logo">
    <h1>AP Calculus Quiz – Tklesson</h1>
    <h2>Product Rule and Quotient Rule</h2>
</header>

<div class="quiz-container">
    <div class="formula-box">
        <strong>Remember the formulas:</strong><br>
        <strong>Product Rule:</strong> $\frac{d}{dx}[f(x)g(x)] = f'(x)g(x) + f(x)g'(x)$<br>
        <strong>Quotient Rule:</strong> $\frac{d}{dx}\left[\frac{f(x)}{g(x)}\right] = \frac{f'(x)g(x) - f(x)g'(x)}{[g(x)]^2}$
    </div>

    <div class="email-container">
        <label for="name">Enter your name (required):</label>
        <input type="text" id="name" placeholder="Your name" required>
    </div>
    <div class="email-container">
        <label for="email">Enter your email (required):</label>
        <input type="email" id="email" placeholder="you@example.com" required>
    </div>

    <div id="quiz-container"></div>

    <div class="button-row">
        <button id="submitBtn" onclick="checkAnswers()">Submit</button>
        <button id="restartBtn" onclick="restartQuiz()">Restart Quiz</button>
        <button id="solution-btn" onclick="showSolution()" style="display:none;">View Solution Pack</button>
    </div>

    <div id="score"></div>
    <div id="submission-message"></div>
</div>

<script>
// === AP Calculus Questions with LaTeX ===
const questions = [
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = x^2 \\cdot \\sin(x)$",
        latex: true,
        options: [
            "$2x\\sin(x) + x^2\\cos(x)$",
            "$2x\\cos(x)$",
            "$x^2\\cos(x)$",
            "$2x\\sin(x) - x^2\\cos(x)$"
        ],
        answer: "$2x\\sin(x) + x^2\\cos(x)$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = \\frac{3x+1}{x^2-4}$",
        latex: true,
        options: [
            "$\\frac{3x^2-2x-12}{(x^2-4)^2}$",
            "$\\frac{-3x^2-2x-12}{(x^2-4)^2}$",
            "$\\frac{3x^2+2x-12}{(x^2-4)^2}$",
            "$\\frac{3x-2}{x^2-4}$"
        ],
        answer: "$\\frac{-3x^2-2x-12}{(x^2-4)^2}$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = x^3 e^x$",
        latex: true,
        options: [
            "$3x^2 e^x$",
            "$x^3 e^x$",
            "$x^2 e^x (3 + x)$",
            "$e^x (3x^2 - x^3)$"
        ],
        answer: "$x^2 e^x (3 + x)$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = \\frac{\\sin x}{x^2+1}$",
        latex: true,
        options: [
            "$\\frac{\\cos x - 2x\\sin x}{(x^2+1)^2}$",
            "$\\frac{(x^2+1)\\cos x - 2x\\sin x}{(x^2+1)^2}$",
            "$\\frac{\\cos x + 2x\\sin x}{(x^2+1)^2}$",
            "$\\frac{\\sin x - 2x\\cos x}{(x^2+1)^2}$"
        ],
        answer: "$\\frac{(x^2+1)\\cos x - 2x\\sin x}{(x^2+1)^2}$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = (x^2+1)(x^3-2x)$",
        latex: true,
        options: [
            "$5x^4 - 3x^2 - 2$",
            "$2x^3 + 3x^2 - 2$",
            "$5x^3 - 3x - 2$",
            "$2x(x^3-2x) + (x^2+1)(3x^2)$"
        ],
        answer: "$5x^4 - 3x^2 - 2$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = \\frac{2x-3}{x+5}$",
        latex: true,
        options: [
            "$\\frac{2}{x+5}$",
            "$\\frac{13}{(x+5)^2}$",
            "$\\frac{2x-3}{(x+5)^2}$",
            "$-\\frac{13}{(x+5)^2}$"
        ],
        answer: "$\\frac{13}{(x+5)^2}$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = x \\ln(x)$",
        latex: true,
        options: [
            "$\\frac{1}{x}$",
            "$\\ln(x)$",
            "$\\ln(x) + 1$",
            "$x + \\frac{1}{x}$"
        ],
        answer: "$\\ln(x) + 1$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = \\frac{e^x}{x^2}$",
        latex: true,
        options: [
            "$\\frac{e^x}{x^2}$",
            "$\\frac{e^x(1-2x)}{x^4}$",
            "$\\frac{e^x(x-2)}{x^3}$",
            "$\\frac{e^x}{x}$"
        ],
        answer: "$\\frac{e^x(x-2)}{x^3}$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = x^2 \\cos(x)$",
        latex: true,
        options: [
            "$2x \\cos x + x^2 \\sin x$",
            "$2x \\cos x - x^2 \\sin x$",
            "$-2x \\sin x - x^2 \\cos x$",
            "$x^2 \\cos x - 2x \\sin x$"
        ],
        answer: "$2x \\cos x - x^2 \\sin x$"
    },
    {
        type: 'mcq',
        q: "Find the derivative of $f(x) = \\frac{3x^2-1}{2x+4}$",
        latex: true,
        options: [
            "$\\frac{3x^2+12x+1}{2(x+2)^2}$",
            "$\\frac{6x^2+24x+2}{(2x+4)^2}$",
            "$\\frac{6x}{2x+4}$",
            "$\\frac{3x-1}{x+2}$"
        ],
        answer: "$\\frac{3x^2+12x+1}{2(x+2)^2}$"
    }
];

// Shuffle helper - Fisher-Yates algorithm
function shuffleArray(arr){ 
    const shuffled = [...arr];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Store the original questions and shuffled state
let originalQuestions = [...questions];
let shuffledQuestions = [];
let questionData = []; // Will store both question and shuffled options

// Initialize quiz data with shuffled questions and options
function initializeQuizData() {
    // Shuffle question order
    shuffledQuestions = shuffleArray(originalQuestions);
    
    // For each question, shuffle options and track correct answer
    questionData = shuffledQuestions.map(q => {
        // Create array of option objects with their values
        const optionObjects = q.options.map(opt => ({
            value: opt,
            isCorrect: normalizeAns(opt) === normalizeAns(q.answer)
        }));
        
        // Shuffle the options
        const shuffledOptions = shuffleArray(optionObjects);
        
        // Find the correct answer in shuffled options
        const correctOptionIndex = shuffledOptions.findIndex(opt => opt.isCorrect);
        
        return {
            ...q,
            displayedOptions: shuffledOptions.map(opt => opt.value),
            correctOptionIndex: correctOptionIndex,
            originalAnswer: q.answer
        };
    });
}

const container = document.getElementById('quiz-container');

// Render quiz dynamically with shuffled options
function renderQuiz(){
    container.innerHTML = '';
    
    questionData.forEach((q, idx) => {
        const div = document.createElement('div');
        div.classList.add('question');
        div.id = `qdiv${idx}`;

        let html = `<p>${idx + 1}. ${q.q}</p>`;
        
        html += `<div class="options">`;
        // Use the pre-shuffled options
        html += q.displayedOptions.map((opt, optIdx) => 
            `<label><input type="radio" name="q${idx}" value="${optIdx}"> ${opt}</label>`
        ).join('');
        html += `</div>`;

        div.innerHTML = html;
        container.appendChild(div);
    });

    // Reset score and messages
    document.getElementById('score').innerText = '';
    document.getElementById('solution-btn').style.display = 'none';
    document.getElementById('submission-message').textContent = '';
    
    // Typeset MathJax after rendering
    if (window.MathJax) {
        MathJax.typeset();
    }
}

// Normalize user input (remove LaTeX delimiters for comparison)
function normalizeAns(s){
    return s.replace(/\$/g, '').replace(/\\/g, '').replace(/\s+/g, '').toLowerCase();
}

// Check answers
async function checkAnswers(){
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const msgEl = document.getElementById('submission-message');

    msgEl.textContent = '';
    if(!nameInput.value.trim()){ 
        msgEl.textContent = "Name is required!"; 
        msgEl.style.color = 'red';
        nameInput.focus(); 
        return; 
    }
    if(!emailInput.value.trim()){ 
        msgEl.textContent = "Email is required!"; 
        msgEl.style.color = 'red';
        emailInput.focus(); 
        return; 
    }

    let score = 0;
    const submissionData = [];

    questionData.forEach((q, idx) => {
        const div = document.getElementById(`qdiv${idx}`);
        div.classList.remove('correct', 'wrong');
        
        // Remove any previous correct answer display
        const oldAnswer = div.querySelector('.correct-answer-display');
        if (oldAnswer) oldAnswer.remove();

        const selected = document.querySelector(`input[name="q${idx}"]:checked`);
        const userSelectedIndex = selected ? parseInt(selected.value) : -1;
        const isCorrect = userSelectedIndex === q.correctOptionIndex;

        if(isCorrect){
            div.classList.add('correct');
            score++;
        } else {
            div.classList.add('wrong');
            // Show correct answer
            const answerDisplay = document.createElement('div');
            answerDisplay.className = 'correct-answer-display';
            answerDisplay.style.color = '#01579b';
            answerDisplay.style.marginTop = '6px';
            answerDisplay.style.fontWeight = 'bold';
            answerDisplay.innerHTML = `Correct answer: ${q.displayedOptions[q.correctOptionIndex]}`;
            div.appendChild(answerDisplay);
        }

        submissionData.push({
            question: q.q,
            correctAnswer: q.originalAnswer,
            userAnswer: userSelectedIndex !== -1 ? q.displayedOptions[userSelectedIndex] : 'No answer',
            userSelectedIndex: userSelectedIndex,
            correctOptionIndex: q.correctOptionIndex
        });
    });

    document.getElementById('score').innerHTML = `Your score: <strong>${score} / ${questionData.length}</strong>`;
    document.getElementById('solution-btn').style.display = 'inline-block';

    // Disable further selection
    const allInputs = document.querySelectorAll('#quiz-container input[type="radio"]');
    allInputs.forEach(input => input.disabled = true);

    // Re-typeset MathJax after showing answers
    if (window.MathJax) {
        MathJax.typeset();
    }

    try {
        const response = await fetch('https://myedu-backend.onrender.com/submit-quiz', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                name: nameInput.value.trim(),
                email: emailInput.value.trim(),
                score,
                total: questionData.length,
                test: "AP Calculus – Product & Quotient Rules Quiz",
                answers: submissionData
            })
        });
        const result = await response.json();
        msgEl.textContent = result.message || "Quiz submitted successfully!";
        msgEl.style.color = '#01579b';
    } catch(err) {
        console.error(err);
        msgEl.textContent = "Quiz results saved locally. Server submission failed.";
        msgEl.style.color = 'orange';
    }
}

// Restart quiz
function restartQuiz(){
    initializeQuizData(); // Re-shuffle both questions and options
    renderQuiz();
    
    // Re-enable submit button and inputs
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('submitBtn').style.backgroundColor = '';
    
    // Re-enable all radio buttons
    const allInputs = document.querySelectorAll('#quiz-container input[type="radio"]');
    allInputs.forEach(input => input.disabled = false);
}

// Show solution with LaTeX
function showSolution(){
    const solutions = `
        <div style="max-width: 800px; padding: 20px; font-family: Arial, sans-serif;">
            <h2 style="color: #01579b;">AP Calculus - Product & Quotient Rule Solutions</h2>
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>Formulas:</strong><br>
                • Product Rule: $\\frac{d}{dx}[f(x)g(x)] = f'(x)g(x) + f(x)g'(x)$<br>
                • Quotient Rule: $\\frac{d}{dx}\\left[\\frac{f(x)}{g(x)}\\right] = \\frac{f'(x)g(x) - f(x)g'(x)}{[g(x)]^2}$
            </div>
            
            <ol style="line-height: 1.8;">
                <li><strong>$f(x) = x^2 \\sin(x)$</strong><br>
                    $f'(x) = 2x\\sin(x) + x^2\\cos(x)$</li>
                
                <li><strong>$f(x) = \\frac{3x+1}{x^2-4}$</strong><br>
                    $f'(x) = \\frac{-3x^2-2x-12}{(x^2-4)^2}$</li>
                
                <li><strong>$f(x) = x^3 e^x$</strong><br>
                    $f'(x) = x^2 e^x (3 + x)$</li>
                
                <li><strong>$f(x) = \\frac{\\sin x}{x^2+1}$</strong><br>
                    $f'(x) = \\frac{(x^2+1)\\cos x - 2x\\sin x}{(x^2+1)^2}$</li>
                
                <li><strong>$f(x) = (x^2+1)(x^3-2x)$</strong><br>
                    $f'(x) = 5x^4 - 3x^2 - 2$</li>
                
                <li><strong>$f(x) = \\frac{2x-3}{x+5}$</strong><br>
                    $f'(x) = \\frac{13}{(x+5)^2}$</li>
                
                <li><strong>$f(x) = x \\ln(x)$</strong><br>
                    $f'(x) = \\ln(x) + 1$</li>
                
                <li><strong>$f(x) = \\frac{e^x}{x^2}$</strong><br>
                    $f'(x) = \\frac{e^x(x-2)}{x^3}$</li>
                
                <li><strong>$f(x) = x^2 \\cos(x)$</strong><br>
                    $f'(x) = 2x \\cos x - x^2 \\sin x$</li>
                
                <li><strong>$f(x) = \\frac{3x^2-1}{2x+4}$</strong><br>
                    $f'(x) = \\frac{3x^2+12x+1}{2(x+2)^2}$</li>
            </ol>
        </div>
    `;
    
    const solutionWindow = window.open('', '_blank', 'width=900,height=700');
    solutionWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>AP Calculus Solutions</title>
            <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"><\/script>
            <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
            <script>
                MathJax = {
                    tex: { inlineMath: [['$', '$'], ['\\\\(', '\\\\)']] }
                };
            <\/script>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                .solution-item { margin-bottom: 25px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
            <\/style>
        <\/head>
        <body>${solutions}<\/body>
        <\/html>
    `);
    solutionWindow.document.close();
}

// Initialize quiz
initializeQuizData();
renderQuiz();
</script>

</body>
</html>
